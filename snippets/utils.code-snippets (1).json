{"generator":"Code Snippets v3.9.3","date_created":"2025-12-12 19:47","snippets":[{"id":8,"name":"utils","code":"\n\/***************************************************\n * GOFAST \u2013 UTILIDADES\n * Formato de dinero en campos con clase gofast-money\n * Funciones helper para fechas en zona horaria de Colombia\n ***************************************************\/\n\n\/\/ Configurar zona horaria de Colombia globalmente\nif (!function_exists('gofast_set_timezone')) {\n    function gofast_set_timezone() {\n        date_default_timezone_set('America\/Bogota');\n    }\n    gofast_set_timezone();\n}\n\n\/**\n * Obtener fecha\/hora actual en zona horaria de Colombia\n * @param string $format Formato de fecha (por defecto 'Y-m-d H:i:s')\n * @return string Fecha formateada en zona horaria de Colombia\n *\/\nif (!function_exists('gofast_date')) {\n    function gofast_date($format = 'Y-m-d H:i:s') {\n        $timezone = new DateTimeZone('America\/Bogota');\n        $datetime = new DateTime('now', $timezone);\n        return $datetime->format($format);\n    }\n}\n\n\/**\n * Obtener fecha actual en formato Y-m-d (zona horaria de Colombia)\n * @return string Fecha en formato Y-m-d\n *\/\nif (!function_exists('gofast_date_today')) {\n    function gofast_date_today() {\n        return gofast_date('Y-m-d');\n    }\n}\n\n\/**\n * Obtener fecha\/hora actual en formato MySQL (zona horaria de Colombia)\n * @return string Fecha en formato MySQL (Y-m-d H:i:s)\n *\/\nif (!function_exists('gofast_date_mysql')) {\n    function gofast_date_mysql() {\n        return gofast_date('Y-m-d H:i:s');\n    }\n}\n\n\/**\n * Formatear fecha con strtotime respetando zona horaria de Colombia\n * @param string $date Fecha a formatear\n * @param string $format Formato de salida (por defecto 'Y-m-d H:i:s')\n * @return string Fecha formateada\n *\/\nif (!function_exists('gofast_date_format')) {\n    function gofast_date_format($date, $format = 'Y-m-d H:i:s') {\n        $timezone = new DateTimeZone('America\/Bogota');\n        $datetime = new DateTime($date, $timezone);\n        return $datetime->format($format);\n    }\n}\n\n\/**\n * Obtener fecha\/hora actual en zona horaria de Colombia (equivalente a current_time de WordPress)\n * @param string $type Tipo de formato ('mysql', 'timestamp', o formato de fecha como 'Y-m-d')\n * @return string|int Fecha formateada o timestamp\n *\/\nif (!function_exists('gofast_current_time')) {\n    function gofast_current_time($type = 'mysql') {\n        $timezone = new DateTimeZone('America\/Bogota');\n        $datetime = new DateTime('now', $timezone);\n        \n        if ($type === 'mysql') {\n            return $datetime->format('Y-m-d H:i:s');\n        } elseif ($type === 'timestamp') {\n            return $datetime->getTimestamp();\n        } else {\n            \/\/ Cualquier otro formato de fecha\n            return $datetime->format($type);\n        }\n    }\n}\n\n\/**\n * Limpiar y validar n\u00famero de WhatsApp\n * @param mixed $whatsapp Valor del WhatsApp (puede ser string o int)\n * @return string WhatsApp limpio o cadena vac\u00eda si es inv\u00e1lido\n *\/\nif (!function_exists('gofast_clean_whatsapp')) {\n    function gofast_clean_whatsapp($whatsapp) {\n        \/\/ Convertir a string y limpiar\n        $whatsapp = (string) $whatsapp;\n        \/\/ Remover todo excepto n\u00fameros\n        $whatsapp = preg_replace('\/[^0-9]\/', '', $whatsapp);\n        \/\/ Valores problem\u00e1ticos comunes (l\u00edmites de INT)\n        $valores_invalidos = ['2147483647', '0', '2147483648', '-2147483648'];\n        if (empty($whatsapp) || in_array($whatsapp, $valores_invalidos)) {\n            return '';\n        }\n        return $whatsapp;\n    }\n}\n\n\/\/ Protecci\u00f3n global para toggleOtro - se ejecuta inmediatamente\nadd_action('wp_head', function() {\n?>\n<script>\n\/\/ Protecci\u00f3n global para toggleOtro - previene errores en p\u00e1ginas donde los elementos no existen\n\/\/ Se ejecuta inmediatamente para proteger antes de que otros scripts se carguen\n(function() {\n    \/\/ Crear una funci\u00f3n segura por defecto\n    if (typeof window.toggleOtro === 'undefined') {\n        window.toggleOtro = function() {\n            \/\/ Funci\u00f3n vac\u00eda segura - no hacer nada si los elementos no existen\n            return;\n        };\n    }\n    \n    \/\/ Interceptar setTimeout para proteger llamadas a toggleOtro\n    const originalSetTimeout = window.setTimeout;\n    window.setTimeout = function(func, delay) {\n        if (typeof func === 'function') {\n            const funcStr = func.toString();\n            if (funcStr.includes('toggleOtro')) {\n                \/\/ Verificar si los elementos existen antes de ejecutar\n                const tipoSelect = document.getElementById(\"tipo_negocio\");\n                const wrapperOtro = document.getElementById(\"tipo_otro_wrapper\");\n                const inputOtro = document.getElementById(\"tipo_otro\");\n                if (!tipoSelect || !wrapperOtro || !inputOtro) {\n                    \/\/ No ejecutar si los elementos no existen\n                    return null;\n                }\n            }\n        }\n        return originalSetTimeout.apply(this, arguments);\n    };\n})();\n<\/script>\n<?php\n}, 1);\n\nadd_action('wp_footer', function() {\n?>\n<script>\n\/\/ Proteger toggleOtro nuevamente en el footer por si se redefine despu\u00e9s\n(function() {\n    if (typeof window.toggleOtro === 'function') {\n        const originalToggleOtro = window.toggleOtro;\n        window.toggleOtro = function() {\n            try {\n                const tipoSelect = document.getElementById(\"tipo_negocio\");\n                const wrapperOtro = document.getElementById(\"tipo_otro_wrapper\");\n                const inputOtro = document.getElementById(\"tipo_otro\");\n                \n                \/\/ Solo ejecutar si todos los elementos existen\n                if (tipoSelect && wrapperOtro && inputOtro) {\n                    return originalToggleOtro.apply(this, arguments);\n                }\n            } catch(e) {\n                \/\/ Silenciar cualquier error\n                return;\n            }\n        };\n    }\n})();\n\ndocument.addEventListener(\"input\", function(e) {\n    if (e.target.classList.contains(\"gofast-money\")) {\n        let raw = e.target.value.replace(\/[^\\d]\/g, \"\");\n        e.target.value = raw ? \"$ \" + Number(raw).toLocaleString(\"es-CO\") : \"\";\n    }\n});\n<\/script>\n<?php\n});\n\n","active":true,"modified":"2025-12-12 13:41:40","revision":"1"}]}