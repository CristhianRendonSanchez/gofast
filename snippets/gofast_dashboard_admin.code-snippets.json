{"generator":"Code Snippets v3.9.3","date_created":"2025-12-12 19:47","snippets":[{"id":25,"name":"gofast_dashboard_admin","code":"\/***************************************************\n * GOFAST \u2013 DASHBOARD ADMINISTRATIVO\n * Shortcode: [gofast_dashboard_admin]\n * URL: \/dashboard-admin\n ***************************************************\/\nfunction gofast_dashboard_admin_shortcode() {\n    if (session_status() === PHP_SESSION_NONE) {\n        session_start();\n    }\n\n    global $wpdb;\n\n    \/* ==========================================================\n       0. Validar usuario admin\n    ========================================================== *\/\n    $usuario = null;\n    if (!empty($_SESSION['gofast_user_id'])) {\n        $uid = (int) $_SESSION['gofast_user_id'];\n        $usuario = $wpdb->get_row(\n            $wpdb->prepare(\n                \"SELECT id, nombre, rol, activo \n                 FROM usuarios_gofast \n                 WHERE id = %d AND activo = 1\",\n                $uid\n            )\n        );\n    }\n\n    if (!$usuario || strtolower($usuario->rol) !== 'admin') {\n        return \"<div class='gofast-box'>\n                    \u26a0\ufe0f Solo los administradores pueden acceder al panel.\n                <\/div>\";\n    }\n\n    \/* ==========================================================\n       1. Estad\u00edsticas r\u00e1pidas\n    ========================================================== *\/\n    \/\/ Total de destinos (suma de todos los destinos en JSON) - igual que gofast_home.php\n    $total_destinos = (int) ($wpdb->get_var(\n        \"SELECT SUM(JSON_LENGTH(JSON_EXTRACT(destinos, '$.destinos'))) FROM servicios_gofast\"\n    ) ?? 0);\n    \n    \/\/ Total compras (excluyendo canceladas) - igual que gofast_home.php\n    $total_compras = (int) $wpdb->get_var(\"SELECT COUNT(*) FROM compras_gofast WHERE estado != 'cancelada'\");\n    \n    \/\/ Usuarios\n    $total_usuarios = (int) $wpdb->get_var(\"SELECT COUNT(*) FROM usuarios_gofast WHERE activo = 1\");\n    $total_clientes = (int) $wpdb->get_var(\"SELECT COUNT(*) FROM usuarios_gofast WHERE rol = 'cliente' AND activo = 1\");\n    $total_mensajeros = (int) $wpdb->get_var(\"SELECT COUNT(*) FROM usuarios_gofast WHERE rol = 'mensajero' AND activo = 1\");\n    \n    \/\/ Ingresos totales (servicios no cancelados + compras no canceladas) - igual que gofast_home.php\n    $ingresos_servicios = (float) ($wpdb->get_var(\"SELECT SUM(total) FROM servicios_gofast WHERE tracking_estado != 'cancelado'\") ?? 0);\n    $ingresos_compras = (float) ($wpdb->get_var(\"SELECT SUM(valor) FROM compras_gofast WHERE estado != 'cancelada'\") ?? 0);\n    $total_ingresos = $ingresos_servicios + $ingresos_compras;\n    \n    \/\/ Destinos hoy (excluyendo cancelados, igual que reportes por d\u00eda)\n    $destinos_hoy = (int) ($wpdb->get_var(\n        $wpdb->prepare(\n            \"SELECT SUM(JSON_LENGTH(JSON_EXTRACT(destinos, '$.destinos'))) \n             FROM servicios_gofast \n             WHERE DATE(fecha) = %s AND tracking_estado != 'cancelado'\",\n            gofast_current_time('Y-m-d')\n        )\n    ) ?? 0);\n    \n    \/\/ Ingresos de hoy (servicios + compras del d\u00eda actual) - igual que reportes\n    $ingresos_servicios_hoy = (float) ($wpdb->get_var(\n        $wpdb->prepare(\n            \"SELECT SUM(total) FROM servicios_gofast \n             WHERE DATE(fecha) = %s AND tracking_estado != 'cancelado'\",\n            gofast_current_time('Y-m-d')\n        )\n    ) ?? 0);\n    \n    $ingresos_compras_hoy = (float) ($wpdb->get_var(\n        $wpdb->prepare(\n            \"SELECT SUM(valor) FROM compras_gofast \n             WHERE DATE(fecha_creacion) = %s AND estado != 'cancelada'\",\n            gofast_current_time('Y-m-d')\n        )\n    ) ?? 0);\n    \n    $ingresos_hoy = $ingresos_servicios_hoy + $ingresos_compras_hoy;\n    $comision_hoy = $ingresos_hoy * 0.20;\n    \n    \/\/ Comisi\u00f3n del mes actual (del primer d\u00eda al \u00faltimo d\u00eda del mes) - zona horaria Colombia\n    \/\/ Igual que reportes: usar fecha >= y fecha <= con formato datetime\n    $fecha_actual = gofast_current_time('Y-m-d');\n    $timezone = new DateTimeZone('America\/Bogota');\n    $datetime = new DateTime($fecha_actual, $timezone);\n    $primer_dia_mes = $datetime->format('Y-m-01');\n    $ultimo_dia_mes = $datetime->format('Y-m-t');\n    \n    $ingresos_servicios_mes = (float) ($wpdb->get_var(\n        $wpdb->prepare(\n            \"SELECT SUM(total) FROM servicios_gofast \n             WHERE fecha >= %s AND fecha <= %s AND tracking_estado != 'cancelado'\",\n            $primer_dia_mes . ' 00:00:00',\n            $ultimo_dia_mes . ' 23:59:59'\n        )\n    ) ?? 0);\n    \n    $ingresos_compras_mes = (float) ($wpdb->get_var(\n        $wpdb->prepare(\n            \"SELECT SUM(valor) FROM compras_gofast \n             WHERE fecha_creacion >= %s AND fecha_creacion <= %s AND estado != 'cancelada'\",\n            $primer_dia_mes . ' 00:00:00',\n            $ultimo_dia_mes . ' 23:59:59'\n        )\n    ) ?? 0);\n    \n    $ingresos_mes = $ingresos_servicios_mes + $ingresos_compras_mes;\n    $comision_mes = $ingresos_mes * 0.20;\n\n    \/* ==========================================================\n       2. HTML\n    ========================================================== *\/\n    ob_start();\n    ?>\n\n<div class=\"gofast-home\">\n    <h1 style=\"margin-bottom:8px;\">\u2699\ufe0f Panel Administrativo<\/h1>\n    <p class=\"gofast-home-text\">\n        Gestiona pedidos, usuarios, recargos y visualiza reportes del sistema.\n    <\/p>\n\n    <!-- Enlaces de navegaci\u00f3n - PRIMERO -->\n    <div class=\"gofast-dashboard-links\" style=\"display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:16px;margin:24px 0;\">\n        \n        <a href=\"<?php echo esc_url( home_url('\/mis-pedidos') ); ?>\" class=\"gofast-box\" style=\"display:block;text-decoration:none;padding:24px;transition:transform 0.2s, box-shadow 0.2s;\" onmouseover=\"this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';\" onmouseout=\"this.style.transform='';this.style.boxShadow='';\">\n            <div style=\"font-size:40px;margin-bottom:12px;\">\ud83d\udce6<\/div>\n            <h3 style=\"margin:0 0 8px 0;color:#1a1a1a;\">Gesti\u00f3n de Pedidos<\/h3>\n            <p style=\"margin:0;color:#666;font-size:14px;\">Ver, filtrar y gestionar todos los pedidos del sistema<\/p>\n        <\/a>\n\n        <a href=\"<?php echo esc_url( home_url('\/admin-usuarios') ); ?>\" class=\"gofast-box\" style=\"display:block;text-decoration:none;padding:24px;transition:transform 0.2s, box-shadow 0.2s;\" onmouseover=\"this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';\" onmouseout=\"this.style.transform='';this.style.boxShadow='';\">\n            <div style=\"font-size:40px;margin-bottom:12px;\">\ud83d\udc65<\/div>\n            <h3 style=\"margin:0 0 8px 0;color:#1a1a1a;\">Gesti\u00f3n de Usuarios<\/h3>\n            <p style=\"margin:0;color:#666;font-size:14px;\">Crear, editar y gestionar usuarios, clientes y mensajeros<\/p>\n        <\/a>\n\n        <a href=\"<?php echo esc_url( home_url('\/recargos') ); ?>\" class=\"gofast-box\" style=\"display:block;text-decoration:none;padding:24px;transition:transform 0.2s, box-shadow 0.2s;\" onmouseover=\"this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';\" onmouseout=\"this.style.transform='';this.style.boxShadow='';\">\n            <div style=\"font-size:40px;margin-bottom:12px;\">\u2699\ufe0f<\/div>\n            <h3 style=\"margin:0 0 8px 0;color:#1a1a1a;\">Administraci\u00f3n de Recargos<\/h3>\n            <p style=\"margin:0;color:#666;font-size:14px;\">Configurar recargos fijos y por valor para las cotizaciones<\/p>\n        <\/a>\n\n        <a href=\"<?php echo esc_url( home_url('\/admin-reportes') ); ?>\" class=\"gofast-box\" style=\"display:block;text-decoration:none;padding:24px;transition:transform 0.2s, box-shadow 0.2s;\" onmouseover=\"this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';\" onmouseout=\"this.style.transform='';this.style.boxShadow='';\">\n            <div style=\"font-size:40px;margin-bottom:12px;\">\ud83d\udcca<\/div>\n            <h3 style=\"margin:0 0 8px 0;color:#1a1a1a;\">Reportes y Estad\u00edsticas<\/h3>\n            <p style=\"margin:0;color:#666;font-size:14px;\">Ver reportes detallados, estad\u00edsticas y exportar datos<\/p>\n        <\/a>\n\n        <a href=\"<?php echo esc_url( home_url('\/transferencias') ); ?>\" class=\"gofast-box\" style=\"display:block;text-decoration:none;padding:24px;transition:transform 0.2s, box-shadow 0.2s;\" onmouseover=\"this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';\" onmouseout=\"this.style.transform='';this.style.boxShadow='';\">\n            <div style=\"font-size:40px;margin-bottom:12px;\">\ud83d\udcb0<\/div>\n            <h3 style=\"margin:0 0 8px 0;color:#1a1a1a;\">Transferencias<\/h3>\n            <p style=\"margin:0;color:#666;font-size:14px;\">Gestionar transferencias de mensajeros y aprobar pagos<\/p>\n        <\/a>\n\n        <a href=\"<?php echo esc_url( home_url('\/compras') ); ?>\" class=\"gofast-box\" style=\"display:block;text-decoration:none;padding:24px;transition:transform 0.2s, box-shadow 0.2s;\" onmouseover=\"this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';\" onmouseout=\"this.style.transform='';this.style.boxShadow='';\">\n            <div style=\"font-size:40px;margin-bottom:12px;\">\ud83d\uded2<\/div>\n            <h3 style=\"margin:0 0 8px 0;color:#1a1a1a;\">Compras<\/h3>\n            <p style=\"margin:0;color:#666;font-size:14px;\">Gestionar compras de mensajeros y asignar servicios<\/p>\n        <\/a>\n\n        <a href=\"<?php echo esc_url( home_url('\/admin-cotizar') ); ?>\" class=\"gofast-box\" style=\"display:block;text-decoration:none;padding:24px;transition:transform 0.2s, box-shadow 0.2s;\" onmouseover=\"this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';\" onmouseout=\"this.style.transform='';this.style.boxShadow='';\">\n            <div style=\"font-size:40px;margin-bottom:12px;\">\ud83d\ude9a<\/div>\n            <h3 style=\"margin:0 0 8px 0;color:#1a1a1a;\">Crear Servicio<\/h3>\n            <p style=\"margin:0;color:#666;font-size:14px;\">Crear servicio y asignarlo a un mensajero<\/p>\n        <\/a>\n\n        <a href=\"<?php echo esc_url( home_url('\/admin-cotizar-intermunicipal') ); ?>\" class=\"gofast-box\" style=\"display:block;text-decoration:none;padding:24px;transition:transform 0.2s, box-shadow 0.2s;\" onmouseover=\"this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';\" onmouseout=\"this.style.transform='';this.style.boxShadow='';\">\n            <div style=\"font-size:40px;margin-bottom:12px;\">\ud83c\udf10<\/div>\n            <h3 style=\"margin:0 0 8px 0;color:#1a1a1a;\">Env\u00edo Intermunicipal<\/h3>\n            <p style=\"margin:0;color:#666;font-size:14px;\">Crear env\u00edo intermunicipal y asignarlo a un mensajero<\/p>\n        <\/a>\n\n        <a href=\"<?php echo esc_url( home_url('\/admin-negocios') ); ?>\" class=\"gofast-box\" style=\"display:block;text-decoration:none;padding:24px;transition:transform 0.2s, box-shadow 0.2s;\" onmouseover=\"this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';\" onmouseout=\"this.style.transform='';this.style.boxShadow='';\">\n            <div style=\"font-size:40px;margin-bottom:12px;\">\ud83c\udfea<\/div>\n            <h3 style=\"margin:0 0 8px 0;color:#1a1a1a;\">Gesti\u00f3n de Negocios<\/h3>\n            <p style=\"margin:0;color:#666;font-size:14px;\">Ver, editar y eliminar todos los negocios registrados<\/p>\n        <\/a>\n\n        <a href=\"<?php echo esc_url( home_url('\/admin-configuracion') ); ?>\" class=\"gofast-box\" style=\"display:block;text-decoration:none;padding:24px;transition:transform 0.2s, box-shadow 0.2s;\" onmouseover=\"this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';\" onmouseout=\"this.style.transform='';this.style.boxShadow='';\">\n            <div style=\"font-size:40px;margin-bottom:12px;\">\u2699\ufe0f<\/div>\n            <h3 style=\"margin:0 0 8px 0;color:#1a1a1a;\">Configuraci\u00f3n del Sistema<\/h3>\n            <p style=\"margin:0;color:#666;font-size:14px;\">Gestionar tarifas, barrios, sectores y destinos intermunicipales<\/p>\n        <\/a>\n\n        <a href=\"<?php echo esc_url( home_url('\/admin-solicitudes-trabajo') ); ?>\" class=\"gofast-box\" style=\"display:block;text-decoration:none;padding:24px;transition:transform 0.2s, box-shadow 0.2s;\" onmouseover=\"this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';\" onmouseout=\"this.style.transform='';this.style.boxShadow='';\">\n            <div style=\"font-size:40px;margin-bottom:12px;\">\ud83d\udccb<\/div>\n            <h3 style=\"margin:0 0 8px 0;color:#1a1a1a;\">Solicitudes de Trabajo<\/h3>\n            <p style=\"margin:0;color:#666;font-size:14px;\">Ver y gestionar solicitudes de trabajo de mensajeros<\/p>\n        <\/a>\n\n    <\/div>\n\n    <!-- Tarjetas de estad\u00edsticas - DESPU\u00c9S -->\n    <div class=\"gofast-dashboard-stats\" style=\"display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;margin:32px 0;\">\n        \n        <!-- Total Destinos -->\n        <div class=\"gofast-box\" style=\"text-align:center;padding:20px;\">\n            <div style=\"font-size:32px;margin-bottom:8px;\">\ud83d\udccd<\/div>\n            <div style=\"font-size:28px;font-weight:700;color:#F4C524;margin-bottom:4px;\"><?= number_format($total_destinos); ?><\/div>\n            <div style=\"font-size:13px;color:#666;\">Total Destinos<\/div>\n        <\/div>\n\n        <!-- Total Compras -->\n        <div class=\"gofast-box\" style=\"text-align:center;padding:20px;\">\n            <div style=\"font-size:32px;margin-bottom:8px;\">\ud83d\uded2<\/div>\n            <div style=\"font-size:28px;font-weight:700;color:#E91E63;margin-bottom:4px;\"><?= number_format($total_compras); ?><\/div>\n            <div style=\"font-size:13px;color:#666;\">Total Compras<\/div>\n        <\/div>\n\n        <!-- Total Usuarios -->\n        <div class=\"gofast-box\" style=\"text-align:center;padding:20px;\">\n            <div style=\"font-size:32px;margin-bottom:8px;\">\ud83d\udc65<\/div>\n            <div style=\"font-size:28px;font-weight:700;color:#9C27B0;margin-bottom:4px;\"><?= number_format($total_usuarios); ?><\/div>\n            <div style=\"font-size:13px;color:#666;\">Total Usuarios<\/div>\n        <\/div>\n\n        <!-- Total Clientes -->\n        <div class=\"gofast-box\" style=\"text-align:center;padding:20px;\">\n            <div style=\"font-size:32px;margin-bottom:8px;\">\ud83d\udecd\ufe0f<\/div>\n            <div style=\"font-size:28px;font-weight:700;color:#2196F3;margin-bottom:4px;\"><?= number_format($total_clientes); ?><\/div>\n            <div style=\"font-size:13px;color:#666;\">Total Clientes<\/div>\n        <\/div>\n\n        <!-- Total Mensajeros -->\n        <div class=\"gofast-box\" style=\"text-align:center;padding:20px;\">\n            <div style=\"font-size:32px;margin-bottom:8px;\">\ud83d\ude9a<\/div>\n            <div style=\"font-size:28px;font-weight:700;color:#00BCD4;margin-bottom:4px;\"><?= number_format($total_mensajeros); ?><\/div>\n            <div style=\"font-size:13px;color:#666;\">Total Mensajeros<\/div>\n        <\/div>\n\n        <!-- Ingresos Totales -->\n        <div class=\"gofast-box\" style=\"text-align:center;padding:20px;\">\n            <div style=\"font-size:32px;margin-bottom:8px;\">\ud83d\udcb0<\/div>\n            <div style=\"font-size:28px;font-weight:700;color:#4CAF50;margin-bottom:4px;\">$<?= number_format($total_ingresos, 0, ',', '.'); ?><\/div>\n            <div style=\"font-size:13px;color:#666;\">Ingresos Totales<\/div>\n        <\/div>\n\n        <!-- Destinos Hoy -->\n        <div class=\"gofast-box\" style=\"text-align:center;padding:20px;\">\n            <div style=\"font-size:32px;margin-bottom:8px;\">\ud83d\udcc5<\/div>\n            <div style=\"font-size:28px;font-weight:700;color:#FF5722;margin-bottom:4px;\"><?= number_format($destinos_hoy); ?><\/div>\n            <div style=\"font-size:13px;color:#666;\">Destinos Hoy<\/div>\n        <\/div>\n\n        <!-- Comisi\u00f3n Hoy -->\n        <div class=\"gofast-box\" style=\"text-align:center;padding:20px;\">\n            <div style=\"font-size:32px;margin-bottom:8px;\">\ud83d\udcb5<\/div>\n            <div style=\"font-size:28px;font-weight:700;color:#FF9800;margin-bottom:4px;\">$<?= number_format($comision_hoy, 0, ',', '.'); ?><\/div>\n            <div style=\"font-size:13px;color:#666;\">Comisi\u00f3n Hoy<\/div>\n        <\/div>\n\n        <!-- Comisi\u00f3n del Mes -->\n        <div class=\"gofast-box\" style=\"text-align:center;padding:20px;\">\n            <div style=\"font-size:32px;margin-bottom:8px;\">\ud83d\udcca<\/div>\n            <div style=\"font-size:28px;font-weight:700;color:#9C27B0;margin-bottom:4px;\">$<?= number_format($comision_mes, 0, ',', '.'); ?><\/div>\n            <div style=\"font-size:13px;color:#666;\">Comisi\u00f3n del Mes<\/div>\n        <\/div>\n\n    <\/div>\n\n<\/div>\n\n<?php\n    return ob_get_clean();\n}\nadd_shortcode('gofast_dashboard_admin', 'gofast_dashboard_admin_shortcode');\n\n","active":true,"modified":"2025-12-12 13:24:43","revision":"1"}]}