{"generator":"Code Snippets v3.9.3","date_created":"2025-12-12 19:47","snippets":[{"id":37,"name":"gofast_admin_negocios","code":"\n\/***************************************************\n * GOFAST \u2013 ADMINISTRACI\u00d3N DE NEGOCIOS (SOLO ADMIN)\n * Shortcode: [gofast_admin_negocios]\n * URL: \/admin-negocios\n * \n * Funcionalidades:\n * - Ver todos los negocios registrados\n * - Editar cualquier negocio\n * - Eliminar negocios\n * - Activar\/desactivar negocios\n ***************************************************\/\nfunction gofast_admin_negocios_shortcode() {\n    global $wpdb;\n\n    if (session_status() === PHP_SESSION_NONE) {\n        session_start();\n    }\n\n    \/\/ Validar usuario admin\n    if (empty($_SESSION['gofast_user_id'])) {\n        return \"<div class='gofast-box'>Debes iniciar sesi\u00f3n para acceder a esta secci\u00f3n.<\/div>\";\n    }\n\n    $user_id = (int) $_SESSION['gofast_user_id'];\n    $rol = strtolower($_SESSION['gofast_user_rol'] ?? 'cliente');\n\n    if ($rol !== 'admin') {\n        return \"<div class='gofast-box'>\u26a0\ufe0f Solo los administradores pueden acceder a esta secci\u00f3n.<\/div>\";\n    }\n\n    $mensaje = '';\n    $mensaje_tipo = '';\n\n    \/*********************************************\n     * PROCESAMIENTO DE FORMULARIOS\n     *********************************************\/\n\n    \/\/ 1. EDITAR NEGOCIO\n    if (isset($_POST['gofast_editar_negocio']) && wp_verify_nonce($_POST['gofast_editar_negocio_nonce'], 'gofast_editar_negocio')) {\n        $negocio_id = (int) $_POST['negocio_id'];\n        $nombre = sanitize_text_field($_POST['nombre'] ?? '');\n        $tipo = sanitize_text_field($_POST['tipo'] ?? '');\n        $tipo_otro = sanitize_text_field($_POST['tipo_otro'] ?? '');\n        $barrio_id = isset($_POST['barrio_id']) ? (int) $_POST['barrio_id'] : 0;\n        $direccion = sanitize_text_field($_POST['direccion_full'] ?? '');\n        $whatsapp = gofast_clean_whatsapp($_POST['whatsapp'] ?? '');\n        $activo = isset($_POST['activo']) ? 1 : 0;\n\n        if (empty($nombre) || empty($direccion) || $barrio_id <= 0) {\n            $mensaje = 'Todos los campos obligatorios deben estar completos.';\n            $mensaje_tipo = 'error';\n        } else {\n            \/\/ Si el tipo es \"Otro\", usar el valor escrito\n            if ($tipo === 'Otro' && !empty($tipo_otro)) {\n                $tipo = $tipo_otro;\n            }\n\n            \/\/ Obtener sector del barrio\n            $sector_id = (int) $wpdb->get_var(\n                $wpdb->prepare(\"SELECT sector_id FROM barrios WHERE id = %d\", $barrio_id)\n            );\n\n            if ($sector_id <= 0) {\n                $mensaje = 'El barrio seleccionado no tiene un sector v\u00e1lido.';\n                $mensaje_tipo = 'error';\n            } else {\n                $actualizado = $wpdb->update(\n                    'negocios_gofast',\n                    [\n                        'nombre' => $nombre,\n                        'tipo' => $tipo,\n                        'barrio_id' => $barrio_id,\n                        'sector_id' => $sector_id,\n                        'direccion_full' => $direccion,\n                        'whatsapp' => $whatsapp,\n                        'activo' => $activo,\n                        'updated_at' => gofast_current_time('mysql')\n                    ],\n                    ['id' => $negocio_id],\n                    ['%s', '%s', '%d', '%d', '%s', '%s', '%d', '%s'],\n                    ['%d']\n                );\n\n                if ($actualizado !== false) {\n                    $mensaje = 'Negocio actualizado correctamente.';\n                    $mensaje_tipo = 'success';\n                } else {\n                    $mensaje = 'Error al actualizar el negocio.';\n                    $mensaje_tipo = 'error';\n                }\n            }\n        }\n    }\n\n    \/\/ 2. ELIMINAR NEGOCIO\n    if (isset($_POST['gofast_eliminar_negocio']) && wp_verify_nonce($_POST['gofast_eliminar_negocio_nonce'], 'gofast_eliminar_negocio')) {\n        $negocio_id = (int) $_POST['negocio_id'];\n\n        $eliminado = $wpdb->delete(\n            'negocios_gofast',\n            ['id' => $negocio_id],\n            ['%d']\n        );\n\n        if ($eliminado) {\n            $mensaje = 'Negocio eliminado correctamente.';\n            $mensaje_tipo = 'success';\n        } else {\n            $mensaje = 'Error al eliminar el negocio.';\n            $mensaje_tipo = 'error';\n        }\n    }\n\n    \/*********************************************\n     * OBTENER DATOS\n     *********************************************\/\n\n    \/\/ Obtener filtro de tipo de negocio\n    $filtro_tipo = isset($_GET['filtro_tipo']) ? sanitize_text_field($_GET['filtro_tipo']) : '';\n\n    \/\/ Tipos de negocio (definir antes de construir la consulta)\n    $tipos_negocio = [\n        \"Panader\u00eda\",\n        \"Pasteler\u00eda \/ Reposter\u00eda\",\n        \"Cafeter\u00eda\",\n        \"Restaurante\",\n        \"Comida r\u00e1pida\",\n        \"Helader\u00eda\",\n        \"Pizzer\u00eda\",\n        \"Asadero\",\n        \"Supermercado \/ Minimarket\",\n        \"Carnicer\u00eda\",\n        \"Pescader\u00eda\",\n        \"Fruver\",\n        \"Boutique\",\n        \"Zapater\u00eda\",\n        \"Tienda de accesorios\",\n        \"Papeler\u00eda\",\n        \"Librer\u00eda\",\n        \"Tienda de regalos\",\n        \"Florister\u00eda\",\n        \"Ferreter\u00eda\",\n        \"Tienda de mascotas \/ Pet shop\",\n        \"Tienda de tecnolog\u00eda\",\n        \"Tienda de electrodom\u00e9sticos\",\n        \"Peluquer\u00eda \/ Barber\u00eda\",\n        \"Spa \/ Centro de belleza\",\n        \"Taller de motos o autos\",\n        \"Servicio t\u00e9cnico de celulares\",\n        \"Lavander\u00eda\",\n        \"Fotocopiadora\",\n        \"Estudio fotogr\u00e1fico\",\n        \"Agencia de publicidad\",\n        \"Gimnasio\",\n        \"Droguer\u00eda \/ Farmacia\",\n        \"Consultorio m\u00e9dico\",\n        \"Odontolog\u00eda\",\n        \"\u00d3ptica\",\n        \"Centro de terapias\",\n        \"Veterinaria\",\n        \"Pintura\",\n        \"Decoraci\u00f3n\",\n        \"Inmobiliaria\",\n        \"Colegio\",\n        \"Tienda online\",\n        \"Marketing digital\",\n        \"Tienda Er\u00f3tica\",\n        \"Tienda de qu\u00edmicos \/ aseo\",\n        \"Lencer\u00eda para el hogar\",\n        \"Otro\"\n    ];\n\n    \/\/ Construir consulta SQL con filtro opcional\n    $sql_base = \"SELECT n.*, \n                u.nombre as cliente_nombre, \n                u.telefono as cliente_telefono,\n                u.email as cliente_email,\n                b.nombre as barrio_nombre,\n                s.nombre as sector_nombre\n         FROM negocios_gofast n\n         LEFT JOIN usuarios_gofast u ON n.user_id = u.id\n         LEFT JOIN barrios b ON n.barrio_id = b.id\n         LEFT JOIN sectores s ON n.sector_id = s.id\";\n    \n    $where_clause = \"\";\n    $sql_params = [];\n    \n    if (!empty($filtro_tipo)) {\n        if ($filtro_tipo === 'Otro') {\n            \/\/ Si el filtro es \"Otro\", mostrar todos los tipos que NO est\u00e1n en la lista predefinida\n            \/\/ Excluir \"Otro\" de la lista para la comparaci\u00f3n\n            $tipos_predefinidos = array_filter($tipos_negocio, function($t) { return $t !== 'Otro'; });\n            if (!empty($tipos_predefinidos)) {\n                $placeholders = implode(',', array_fill(0, count($tipos_predefinidos), '%s'));\n                $where_clause = \" WHERE n.tipo NOT IN ($placeholders)\";\n                $sql_params = array_values($tipos_predefinidos);\n            }\n        } else {\n            \/\/ Filtro normal por tipo espec\u00edfico\n            $where_clause = \" WHERE n.tipo = %s\";\n            $sql_params = [$filtro_tipo];\n        }\n    }\n    \n    $sql = $sql_base . $where_clause . \" ORDER BY n.created_at DESC\";\n    \n    \/\/ Preparar la consulta si hay par\u00e1metros\n    if (!empty($sql_params)) {\n        $sql = $wpdb->prepare($sql, $sql_params);\n    }\n\n    \/\/ Obtener todos los negocios con informaci\u00f3n del cliente\n    $negocios = $wpdb->get_results($sql);\n\n    \/\/ Obtener barrios para el formulario de edici\u00f3n\n    $barrios = $wpdb->get_results(\"SELECT id, nombre FROM barrios ORDER BY nombre ASC\");\n\n    ob_start();\n    ?>\n\n<div class=\"gofast-home\">\n    <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:12px;\">\n        <div>\n            <h1 style=\"margin-bottom:8px;\">\ud83c\udfea Gesti\u00f3n de Negocios<\/h1>\n            <p class=\"gofast-home-text\" style=\"margin:0;\">\n                Administra todos los negocios registrados en el sistema.\n            <\/p>\n        <\/div>\n        <a href=\"<?php echo esc_url( home_url('\/dashboard-admin') ); ?>\" class=\"gofast-btn-request\" style=\"text-decoration:none;white-space:nowrap;\">\n            \u2190 Volver al Dashboard\n        <\/a>\n    <\/div>\n\n    <!-- Mensaje de resultado -->\n    <?php if ($mensaje): ?>\n        <div class=\"gofast-box\" style=\"background: <?= $mensaje_tipo === 'success' ? '#d4edda' : '#f8d7da' ?>; border-left: 4px solid <?= $mensaje_tipo === 'success' ? '#28a745' : '#dc3545' ?>; color: <?= $mensaje_tipo === 'success' ? '#155724' : '#721c24' ?>; margin-bottom: 20px;\">\n            <?= esc_html($mensaje) ?>\n        <\/div>\n    <?php endif; ?>\n\n    <!-- Estad\u00edsticas -->\n    <div class=\"gofast-box\" style=\"margin-bottom: 20px;\">\n        <h3>\ud83d\udcca Estad\u00edsticas<\/h3>\n        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 15px;\">\n            <div style=\"text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;\">\n                <div style=\"font-size: 24px; font-weight: 700; color: #333;\"><?= count($negocios) ?><\/div>\n                <div style=\"font-size: 13px; color: #666;\">Total Negocios<\/div>\n            <\/div>\n            <div style=\"text-align: center; padding: 15px; background: #d4edda; border-radius: 8px;\">\n                <div style=\"font-size: 24px; font-weight: 700; color: #155724;\"><?= count(array_filter($negocios, function($n) { return $n->activo == 1; })) ?><\/div>\n                <div style=\"font-size: 13px; color: #666;\">Activos<\/div>\n            <\/div>\n            <div style=\"text-align: center; padding: 15px; background: #f8d7da; border-radius: 8px;\">\n                <div style=\"font-size: 24px; font-weight: 700; color: #721c24;\"><?= count(array_filter($negocios, function($n) { return $n->activo == 0; })) ?><\/div>\n                <div style=\"font-size: 13px; color: #666;\">Inactivos<\/div>\n            <\/div>\n        <\/div>\n    <\/div>\n\n    <!-- Listado de negocios -->\n    <div class=\"gofast-box\">\n        <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px;\">\n            <h3 style=\"margin:0;\">\ud83d\udccb Todos los Negocios<\/h3>\n            <div style=\"display:flex;gap:8px;align-items:center;flex-wrap:wrap;\">\n                <label style=\"font-weight:600;font-size:14px;white-space:nowrap;\">Filtrar por tipo:<\/label>\n                <select id=\"filtro-tipo-negocio\" \n                        style=\"padding:8px 12px;border:1px solid #ddd;border-radius:6px;font-size:14px;min-width:200px;\"\n                        onchange=\"filtrarPorTipo()\">\n                    <option value=\"\">\u2014 Todos los tipos \u2014<\/option>\n                    <?php foreach ($tipos_negocio as $tipo): ?>\n                        <option value=\"<?= esc_attr($tipo) ?>\" <?= $filtro_tipo === $tipo ? 'selected' : '' ?>>\n                            <?= esc_html($tipo) ?>\n                        <\/option>\n                    <?php endforeach; ?>\n                <\/select>\n                <?php if (!empty($filtro_tipo)): ?>\n                    <a href=\"?\" class=\"gofast-btn-mini\" style=\"background:#6c757d;color:#fff;text-decoration:none;\">\n                        Limpiar filtro\n                    <\/a>\n                <?php endif; ?>\n            <\/div>\n        <\/div>\n        \n        <?php if (empty($negocios)): ?>\n            <p style=\"text-align: center; color: #666; padding: 20px;\">\n                <?= !empty($filtro_tipo) ? 'No hay negocios registrados con el tipo seleccionado.' : 'No hay negocios registrados.' ?>\n            <\/p>\n        <?php else: ?>\n            <!-- Vista Desktop: Tabla -->\n            <div class=\"gofast-negocios-admin-table-wrapper gofast-negocios-admin-desktop\">\n                <div class=\"gofast-table-wrap\">\n                    <table class=\"gofast-table gofast-negocios-admin-table\">\n                        <thead>\n                            <tr>\n                                <th>ID<\/th>\n                                <th>Nombre<\/th>\n                                <th>Cliente<\/th>\n                                <th>Direcci\u00f3n<\/th>\n                                <th>Barrio<\/th>\n                                <th>Tipo<\/th>\n                                <th>WhatsApp<\/th>\n                                <th>Estado<\/th>\n                                <th>Fecha Registro<\/th>\n                                <th>Acciones<\/th>\n                            <\/tr>\n                        <\/thead>\n                        <tbody>\n                            <?php foreach ($negocios as $n): ?>\n                                <tr class=\"<?= $n->activo == 0 ? 'gofast-row-inactive' : '' ?>\">\n                                    <td>#<?= esc_html($n->id) ?><\/td>\n                                    <td><strong><?= esc_html($n->nombre) ?><\/strong><\/td>\n                                    <td>\n                                        <?= esc_html($n->cliente_nombre ?? 'N\/A') ?><br>\n                                        <small style=\"color: #666;\"><?= esc_html($n->cliente_telefono ?? '') ?><\/small>\n                                    <\/td>\n                                    <td><?= esc_html($n->direccion_full) ?><\/td>\n                                    <td><?= esc_html($n->barrio_nombre ?? 'N\/A') ?><\/td>\n                                    <td><?= esc_html($n->tipo) ?><\/td>\n                                    <td><?= gofast_clean_whatsapp($n->whatsapp) ? esc_html(gofast_clean_whatsapp($n->whatsapp)) : '\u2014' ?><\/td>\n                                    <td>\n                                        <span class=\"gofast-badge-estado <?= $n->activo == 1 ? 'gofast-badge-estado-entregado' : 'gofast-badge-estado-cancelado' ?>\">\n                                            <?= $n->activo == 1 ? '\u2705 Activo' : '\u274c Inactivo' ?>\n                                        <\/span>\n                                    <\/td>\n                                    <td><?= gofast_date_format($n->created_at, 'd\/m\/Y') ?><\/td>\n                                    <td style=\"white-space:nowrap;\">\n                                        <button type=\"button\" \n                                                class=\"gofast-btn-mini gofast-btn-editar-negocio-admin\" \n                                                data-negocio-id=\"<?= esc_attr($n->id) ?>\"\n                                                data-negocio-nombre=\"<?= esc_attr($n->nombre) ?>\"\n                                                data-negocio-tipo=\"<?= esc_attr($n->tipo) ?>\"\n                                                data-negocio-barrio-id=\"<?= esc_attr($n->barrio_id) ?>\"\n                                                data-negocio-direccion=\"<?= esc_attr($n->direccion_full) ?>\"\n                                                data-negocio-whatsapp=\"<?= esc_attr(gofast_clean_whatsapp($n->whatsapp)) ?>\"\n                                                data-negocio-activo=\"<?= esc_attr($n->activo) ?>\"\n                                                style=\"background: var(--gofast-yellow); color: #000; margin-right: 4px;\">\n                                            \u270f\ufe0f Editar\n                                        <\/button>\n                                        <form method=\"post\" style=\"display:inline-block;\" onsubmit=\"return confirm('\u00bfEst\u00e1s seguro de eliminar este negocio? Esta acci\u00f3n no se puede deshacer.');\">\n                                            <?php wp_nonce_field('gofast_eliminar_negocio', 'gofast_eliminar_negocio_nonce'); ?>\n                                            <input type=\"hidden\" name=\"gofast_eliminar_negocio\" value=\"1\">\n                                            <input type=\"hidden\" name=\"negocio_id\" value=\"<?= esc_attr($n->id) ?>\">\n                                            <button type=\"submit\" class=\"gofast-btn-mini\" style=\"background:#dc3545;color:#fff;\">\n                                                \ud83d\uddd1\ufe0f Eliminar\n                                            <\/button>\n                                        <\/form>\n                                    <\/td>\n                                <\/tr>\n                            <?php endforeach; ?>\n                        <\/tbody>\n                    <\/table>\n                <\/div>\n            <\/div>\n\n            <!-- Vista M\u00f3vil: Cards -->\n            <div class=\"gofast-negocios-admin-cards gofast-negocios-admin-mobile\">\n                <?php foreach ($negocios as $n): ?>\n                    <div class=\"gofast-negocio-admin-card\" style=\"background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 16px; margin-bottom: 12px; border-left: 4px solid <?= $n->activo == 1 ? '#28a745' : '#dc3545' ?>;\">\n                        <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;\">\n                            <div>\n                                <div style=\"font-size: 12px; color: #666; margin-bottom: 4px;\">ID: #<?= esc_html($n->id) ?><\/div>\n                                <div style=\"font-size: 18px; font-weight: 700; color: #000; margin-bottom: 4px;\">\n                                    <?= esc_html($n->nombre) ?>\n                                <\/div>\n                                <span class=\"gofast-badge-estado <?= $n->activo == 1 ? 'gofast-badge-estado-entregado' : 'gofast-badge-estado-cancelado' ?>\" style=\"font-size: 12px; padding: 4px 10px;\">\n                                    <?= $n->activo == 1 ? '\u2705 Activo' : '\u274c Inactivo' ?>\n                                <\/span>\n                            <\/div>\n                        <\/div>\n\n                        <div style=\"margin-bottom: 12px; padding: 10px; background: #f8f9fa; border-radius: 6px;\">\n                            <div style=\"font-size: 13px; color: #666; margin-bottom: 4px;\">Cliente:<\/div>\n                            <div style=\"font-size: 14px; font-weight: 600; color: #000;\">\n                                <?= esc_html($n->cliente_nombre ?? 'N\/A') ?>\n                            <\/div>\n                            <div style=\"font-size: 12px; color: #666; margin-top: 2px;\">\n                                <?= esc_html($n->cliente_telefono ?? '') ?>\n                            <\/div>\n                        <\/div>\n\n                        <div style=\"margin-bottom: 12px; padding: 10px; background: #f8f9fa; border-radius: 6px;\">\n                            <div style=\"font-size: 13px; color: #666; margin-bottom: 4px;\">Direcci\u00f3n:<\/div>\n                            <div style=\"font-size: 14px; color: #000;\">\n                                <?= esc_html($n->direccion_full) ?>\n                            <\/div>\n                            <div style=\"font-size: 12px; color: #666; margin-top: 4px;\">\n                                <?= esc_html($n->barrio_nombre ?? 'N\/A') ?>\n                            <\/div>\n                        <\/div>\n\n                        <div style=\"margin-bottom: 12px; padding: 10px; background: #f8f9fa; border-radius: 6px;\">\n                            <div style=\"font-size: 13px; color: #666; margin-bottom: 4px;\">Tipo:<\/div>\n                            <div style=\"font-size: 14px; color: #000;\">\n                                <?= esc_html($n->tipo) ?>\n                            <\/div>\n                            <?php \n                            $whatsapp_limpio = gofast_clean_whatsapp($n->whatsapp);\n                            if ($whatsapp_limpio): ?>\n                                <div style=\"font-size: 12px; color: #666; margin-top: 4px;\">\n                                    \ud83d\udcf1 <?= esc_html($whatsapp_limpio) ?>\n                                <\/div>\n                            <?php endif; ?>\n                        <\/div>\n\n                        <div style=\"font-size: 11px; color: #999; margin-bottom: 12px;\">\n                            Registrado: <?= gofast_date_format($n->created_at, 'd\/m\/Y') ?>\n                        <\/div>\n\n                        <div style=\"display: flex; gap: 8px; margin-top: 12px;\">\n                            <button type=\"button\" \n                                    class=\"gofast-btn-mini gofast-btn-editar-negocio-admin\" \n                                    data-negocio-id=\"<?= esc_attr($n->id) ?>\"\n                                    data-negocio-nombre=\"<?= esc_attr($n->nombre) ?>\"\n                                    data-negocio-tipo=\"<?= esc_attr($n->tipo) ?>\"\n                                    data-negocio-barrio-id=\"<?= esc_attr($n->barrio_id) ?>\"\n                                    data-negocio-direccion=\"<?= esc_attr($n->direccion_full) ?>\"\n                                    data-negocio-whatsapp=\"<?= esc_attr($n->whatsapp) ?>\"\n                                    data-negocio-activo=\"<?= esc_attr($n->activo) ?>\"\n                                    style=\"flex: 1; background: var(--gofast-yellow); color: #000;\">\n                                \u270f\ufe0f Editar\n                            <\/button>\n                            <form method=\"post\" style=\"flex: 1;\" onsubmit=\"return confirm('\u00bfEst\u00e1s seguro de eliminar este negocio? Esta acci\u00f3n no se puede deshacer.');\">\n                                <?php wp_nonce_field('gofast_eliminar_negocio', 'gofast_eliminar_negocio_nonce'); ?>\n                                <input type=\"hidden\" name=\"gofast_eliminar_negocio\" value=\"1\">\n                                <input type=\"hidden\" name=\"negocio_id\" value=\"<?= esc_attr($n->id) ?>\">\n                                <button type=\"submit\" \n                                        style=\"width: 100%; background: #dc3545; color: white; border: 0; padding: 12px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;\">\n                                    \ud83d\uddd1\ufe0f Eliminar\n                                <\/button>\n                            <\/form>\n                        <\/div>\n                    <\/div>\n                <?php endforeach; ?>\n            <\/div>\n        <?php endif; ?>\n    <\/div>\n<\/div>\n\n<!-- Modal para editar negocio -->\n<div id=\"modal-editar-negocio-admin\" style=\"display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:10000;overflow-y:auto;padding:20px;\">\n    <div style=\"max-width:600px;margin:20px auto;background:#fff;border-radius:8px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,0.3);\">\n        <h2 style=\"margin-top:0;margin-bottom:12px;font-size:20px;\">\u270f\ufe0f Editar Negocio<\/h2>\n        \n        <form method=\"post\" id=\"form-editar-negocio-admin\" action=\"\">\n            <?php wp_nonce_field('gofast_editar_negocio', 'gofast_editar_negocio_nonce'); ?>\n            <input type=\"hidden\" name=\"gofast_editar_negocio\" value=\"1\">\n            <input type=\"hidden\" name=\"negocio_id\" id=\"editar-negocio-id\">\n            \n            <div style=\"margin-bottom:16px;\">\n                <label style=\"display:block;margin-bottom:8px;font-weight:600;font-size:14px;color:#000;\">Nombre del negocio:<\/label>\n                <input type=\"text\" \n                       name=\"nombre\" \n                       id=\"editar-negocio-nombre\"\n                       required\n                       style=\"width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:16px;\">\n            <\/div>\n            \n            <div style=\"margin-bottom:16px;\">\n                <label style=\"display:block;margin-bottom:8px;font-weight:600;font-size:14px;color:#000;\">Tipo de negocio:<\/label>\n                <select name=\"tipo\" id=\"editar-negocio-tipo\" style=\"width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:16px;\" onchange=\"toggleTipoOtroAdmin()\">\n                    <?php foreach ($tipos_negocio as $tipo): ?>\n                        <option value=\"<?= esc_attr($tipo) ?>\"><?= esc_html($tipo) ?><\/option>\n                    <?php endforeach; ?>\n                <\/select>\n            <\/div>\n            \n            <div id=\"tipo_otro_wrapper_admin\" style=\"display:none;margin-bottom:16px;\">\n                <label style=\"display:block;margin-bottom:8px;font-weight:600;font-size:14px;color:#000;\">Especificar tipo:<\/label>\n                <input type=\"text\" \n                       name=\"tipo_otro\" \n                       id=\"editar-negocio-tipo-otro\"\n                       placeholder=\"Ej: Barber\u00eda\"\n                       style=\"width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:16px;\">\n            <\/div>\n            \n            <div style=\"margin-bottom:16px;\">\n                <label style=\"display:block;margin-bottom:8px;font-weight:600;font-size:14px;color:#000;\">Barrio:<\/label>\n                <select name=\"barrio_id\" id=\"editar-negocio-barrio\" class=\"gofast-select\" required style=\"width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:16px;\">\n                    <option value=\"\">\u2014 Seleccionar barrio \u2014<\/option>\n                    <?php foreach ($barrios as $b): ?>\n                        <option value=\"<?= esc_attr($b->id) ?>\"><?= esc_html($b->nombre) ?><\/option>\n                    <?php endforeach; ?>\n                <\/select>\n            <\/div>\n            \n            <div style=\"margin-bottom:16px;\">\n                <label style=\"display:block;margin-bottom:8px;font-weight:600;font-size:14px;color:#000;\">Direcci\u00f3n completa:<\/label>\n                <input type=\"text\" \n                       name=\"direccion_full\" \n                       id=\"editar-negocio-direccion\"\n                       required\n                       style=\"width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:16px;\">\n            <\/div>\n            \n            <div style=\"margin-bottom:16px;\">\n                <label style=\"display:block;margin-bottom:8px;font-weight:600;font-size:14px;color:#000;\">WhatsApp:<\/label>\n                <input type=\"text\" \n                       name=\"whatsapp\" \n                       id=\"editar-negocio-whatsapp\"\n                       placeholder=\"Ej: 3001234567\"\n                       pattern=\"[0-9]*\"\n                       inputmode=\"numeric\"\n                       style=\"width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:16px;\">\n                <small style=\"display:block;color:#666;font-size:12px;margin-top:4px;\">\n                    Solo n\u00fameros (sin espacios ni caracteres especiales)\n                <\/small>\n            <\/div>\n            \n            <div style=\"margin-bottom:16px;\">\n                <label class=\"gofast-switch\">\n                    <input type=\"checkbox\" name=\"activo\" id=\"editar-negocio-activo\" value=\"1\">\n                    <span class=\"gofast-switch-slider\"><\/span>\n                    <span class=\"gofast-switch-label\">Negocio activo<\/span>\n                <\/label>\n            <\/div>\n            \n            <div style=\"display:flex;gap:8px;justify-content:flex-end;margin-top:16px;padding-top:16px;border-top:1px solid #ddd;\">\n                <button type=\"button\" class=\"gofast-btn-mini gofast-btn-outline\" onclick=\"cerrarModalEditarNegocioAdmin()\">Cancelar<\/button>\n                <button type=\"submit\" class=\"gofast-btn-mini\">Guardar Cambios<\/button>\n            <\/div>\n        <\/form>\n    <\/div>\n<\/div>\n\n<script>\nfunction filtrarPorTipo() {\n    const selectTipo = document.getElementById('filtro-tipo-negocio');\n    if (selectTipo) {\n        const tipo = selectTipo.value;\n        const url = new URL(window.location.href);\n        if (tipo) {\n            url.searchParams.set('filtro_tipo', tipo);\n        } else {\n            url.searchParams.delete('filtro_tipo');\n        }\n        window.location.href = url.toString();\n    }\n}\n\nfunction toggleTipoOtroAdmin() {\n    const tipoSelect = document.getElementById('editar-negocio-tipo');\n    const wrapperOtro = document.getElementById('tipo_otro_wrapper_admin');\n    if (tipoSelect && wrapperOtro) {\n        wrapperOtro.style.display = tipoSelect.value === 'Otro' ? 'block' : 'none';\n    }\n}\n\njQuery(document).ready(function($) {\n    \/\/ Abrir modal de editar negocio\n    $(document).on('click', '.gofast-btn-editar-negocio-admin', function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        \n        const btn = $(this);\n        const negocioId = btn.attr('data-negocio-id');\n        const negocioNombre = btn.attr('data-negocio-nombre');\n        const negocioTipo = btn.attr('data-negocio-tipo');\n        const negocioBarrioId = btn.attr('data-negocio-barrio-id');\n        const negocioDireccion = btn.attr('data-negocio-direccion');\n        const negocioWhatsapp = btn.attr('data-negocio-whatsapp');\n        const negocioActivo = btn.attr('data-negocio-activo');\n        \n        \/\/ Llenar formulario\n        $('#editar-negocio-id').val(negocioId || '');\n        $('#editar-negocio-nombre').val(negocioNombre || '');\n        $('#editar-negocio-direccion').val(negocioDireccion || '');\n        \n        \/\/ Limpiar WhatsApp si es un valor problem\u00e1tico (2147483647 o 0)\n        let whatsappValue = negocioWhatsapp || '';\n        \/\/ Valores problem\u00e1ticos comunes\n        if (whatsappValue == '2147483647' || whatsappValue == '0' || whatsappValue == 2147483647 || whatsappValue == 0 || whatsappValue == '2147483648' || whatsappValue == '-2147483648') {\n            whatsappValue = '';\n        }\n        $('#editar-negocio-whatsapp').val(whatsappValue);\n        $('#editar-negocio-activo').prop('checked', negocioActivo == '1');\n        \n        \/\/ Manejar tipo\n        const tiposDefault = [\n            'Panader\u00eda',\n            'Pasteler\u00eda \/ Reposter\u00eda',\n            'Cafeter\u00eda',\n            'Restaurante',\n            'Comida r\u00e1pida',\n            'Helader\u00eda',\n            'Pizzer\u00eda',\n            'Asadero',\n            'Supermercado \/ Minimarket',\n            'Carnicer\u00eda',\n            'Pescader\u00eda',\n            'Fruver',\n            'Boutique',\n            'Zapater\u00eda',\n            'Tienda de accesorios',\n            'Papeler\u00eda',\n            'Librer\u00eda',\n            'Tienda de regalos',\n            'Florister\u00eda',\n            'Ferreter\u00eda',\n            'Tienda de mascotas \/ Pet shop',\n            'Tienda de tecnolog\u00eda',\n            'Tienda de electrodom\u00e9sticos',\n            'Peluquer\u00eda \/ Barber\u00eda',\n            'Spa \/ Centro de belleza',\n            'Taller de motos o autos',\n            'Servicio t\u00e9cnico de celulares',\n            'Lavander\u00eda',\n            'Fotocopiadora',\n            'Estudio fotogr\u00e1fico',\n            'Agencia de publicidad',\n            'Gimnasio',\n            'Droguer\u00eda \/ Farmacia',\n            'Consultorio m\u00e9dico',\n            'Odontolog\u00eda',\n            '\u00d3ptica',\n            'Centro de terapias',\n            'Veterinaria',\n            'Pintura',\n            'Decoraci\u00f3n',\n            'Inmobiliaria',\n            'Colegio',\n            'Tienda online',\n            'Marketing digital',\n            'Tienda Er\u00f3tica',\n            'Tienda de qu\u00edmicos \/ aseo',\n            'Lencer\u00eda para el hogar',\n            'Otro'\n        ];\n        if (tiposDefault.includes(negocioTipo)) {\n            $('#editar-negocio-tipo').val(negocioTipo);\n            $('#editar-negocio-tipo-otro').val('');\n        } else {\n            $('#editar-negocio-tipo').val('Otro');\n            $('#editar-negocio-tipo-otro').val(negocioTipo);\n        }\n        toggleTipoOtroAdmin();\n        \n        \/\/ Establecer barrio\n        if (negocioBarrioId) {\n            $('#editar-negocio-barrio').val(negocioBarrioId);\n        }\n        \n        \/\/ Mostrar modal\n        $('#modal-editar-negocio-admin').fadeIn(200);\n        \n        return false;\n    });\n    \n    \/\/ Cerrar modal\n    window.cerrarModalEditarNegocioAdmin = function() {\n        $('#modal-editar-negocio-admin').fadeOut(200);\n        $('#form-editar-negocio-admin')[0].reset();\n    };\n    \n    \/\/ Cerrar modal al hacer clic fuera\n    $(document).on('click', '#modal-editar-negocio-admin', function(e) {\n        if (e.target === this) {\n            window.cerrarModalEditarNegocioAdmin();\n        }\n    });\n});\n<\/script>\n\n<style>\n\/* Estilos para tabla de negocios admin *\/\n.gofast-negocios-admin-table-wrapper .gofast-table-wrap {\n    width: 100%;\n    max-width: 100%;\n    overflow-x: auto !important;\n    overflow-y: visible !important;\n    -webkit-overflow-scrolling: touch;\n    display: block;\n    margin: 0;\n    padding: 0;\n}\n\n.gofast-negocios-admin-table-wrapper .gofast-negocios-admin-table {\n    min-width: 1200px;\n    width: 100%;\n    border-collapse: collapse;\n    margin: 0;\n}\n\n\/* Vista Desktop: Mostrar tabla, ocultar cards *\/\n.gofast-negocios-admin-desktop {\n    display: block;\n}\n\n\/* Vista M\u00f3vil: Cards (oculta en desktop) *\/\n.gofast-negocios-admin-mobile {\n    display: none;\n}\n\n.gofast-negocios-admin-cards {\n    width: 100%;\n    max-width: 100%;\n}\n\n.gofast-negocio-admin-card {\n    width: 100%;\n    max-width: 100%;\n    box-sizing: border-box;\n}\n\n\/* Responsive para m\u00f3vil *\/\n@media (max-width: 768px) {\n    .gofast-negocios-admin-desktop {\n        display: none !important;\n    }\n    \n    .gofast-negocios-admin-mobile {\n        display: block !important;\n    }\n}\n<\/style>\n\n    <?php\n    return ob_get_clean();\n}\nadd_shortcode('gofast_admin_negocios', 'gofast_admin_negocios_shortcode');\n\n","active":true,"modified":"2025-12-11 02:08:57","revision":"1"}]}