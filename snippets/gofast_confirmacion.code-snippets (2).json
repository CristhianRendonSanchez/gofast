{"generator":"Code Snippets v3.9.3","date_created":"2025-12-12 19:47","snippets":[{"id":9,"name":"goFast_confirmacion","code":"\n\/*******************************************************\n * \u2705 GOFAST \u2014 CONFIRMACI\u00d3N DE SERVICIO\n * Shortcode: [gofast_confirmacion]\n * URL: \/servicio-registrado?id=XXX\n *******************************************************\/\n\nadd_shortcode(\"gofast_confirmacion\", function() {\n\n    if (session_status() === PHP_SESSION_NONE) session_start();\n    global $wpdb;\n\n    $table = \"servicios_gofast\";\n\n    \/* ==========================================================\n       1. Validar ID\n    ========================================================== *\/\n    if (empty($_GET[\"id\"])) {\n        return \"<div class='gofast-box'>\u274c No se encontr\u00f3 el pedido.<\/div>\";\n    }\n\n    $id = intval($_GET[\"id\"]);\n    $pedido = $wpdb->get_row($wpdb->prepare(\"SELECT * FROM $table WHERE id = %d\", $id));\n\n    if (!$pedido) {\n        return \"<div class='gofast-box'>\u26a0\ufe0f Pedido no encontrado.<\/div>\";\n    }\n\n    \/* ==========================================================\n       2. Vincular usuario autom\u00e1ticamente por tel\u00e9fono\n    ========================================================== *\/\n    if (!empty($pedido->telefono_cliente) && empty($_SESSION[\"gofast_user_id\"])) {\n        $tel = trim($pedido->telefono_cliente);\n\n        $u = $wpdb->get_row($wpdb->prepare(\n            \"SELECT id FROM usuarios_gofast WHERE telefono = %s LIMIT 1\",\n            $tel\n        ));\n\n        if ($u) {\n            \/\/ \u26a0\ufe0f Asocia en DB pero no inicia sesi\u00f3n \"visible\"\n            $wpdb->update($table, [\"user_id\" => $u->id], [\"id\" => $id]);\n            $_SESSION[\"gofast_auto_linked\"] = true;\n            $_SESSION[\"gofast_user_id\"] = intval($u->id);\n        }\n    }\n\n    \/* ==========================================================\n       3. Decodificar JSON de destinos y preparar datos\n    ========================================================== *\/\n    $json = json_decode($pedido->destinos, true);\n    $destinos = $json[\"destinos\"] ?? [];\n    $origen_data = $json[\"origen\"] ?? [];\n    \n    \/\/ Obtener nombre del origen\n    $nombre_origen = '';\n    if (!empty($origen_data['barrio_nombre'])) {\n        $nombre_origen = $origen_data['barrio_nombre'];\n    } elseif (!empty($origen_data['direccion'])) {\n        $nombre_origen = $origen_data['direccion'];\n    } elseif (!empty($pedido->direccion_origen)) {\n        $nombre_origen = $pedido->direccion_origen;\n    }\n    \n    \/\/ Preparar detalle de destinos (similar al mensajero)\n    $detalle_envios = [];\n    $total_calculado = 0;\n    \n    \/\/ Cargar recargos fijos y variables para calcular recargos autom\u00e1ticos\n    $recargos_fijos = $wpdb->get_results(\"SELECT id, nombre, valor_fijo FROM recargos WHERE activo = 1 AND tipo = 'fijo'\");\n    $recargo_fijo_por_envio = 0;\n    foreach ((array) $recargos_fijos as $r) {\n        $monto = intval($r->valor_fijo);\n        if ($monto > 0) {\n            $recargo_fijo_por_envio += $monto;\n        }\n    }\n    \n    $recargos_variables = $wpdb->get_results(\"SELECT r.id, r.nombre, rr.monto_min, rr.monto_max, rr.recargo FROM recargos r JOIN recargos_rangos rr ON rr.recargo_id = r.id WHERE r.activo = 1 AND r.tipo = 'por_valor' ORDER BY rr.monto_min ASC\");\n    $calcular_recargos_variables = function($valor) use ($recargos_variables) {\n        $valor = intval($valor);\n        $total_variable = 0;\n        foreach ((array) $recargos_variables as $r) {\n            $min = intval($r->monto_min);\n            $max = intval($r->monto_max);\n            $rec = intval($r->recargo);\n            $cumple_min = ($valor >= $min);\n            $cumple_max = ($max <= 0) ? true : ($valor <= $max);\n            if ($cumple_min && $cumple_max && $rec > 0) {\n                $total_variable += $rec;\n            }\n        }\n        return $total_variable;\n    };\n    \n    foreach ($destinos as $d) {\n        $nombre_destino = '';\n        if (!empty($d['barrio_nombre'])) {\n            $nombre_destino = $d['barrio_nombre'];\n        } elseif (!empty($d['direccion'])) {\n            $nombre_destino = $d['direccion'];\n        }\n        \n        if (empty($nombre_destino)) continue;\n        \n        \/\/ Obtener monto (si est\u00e1 en el JSON)\n        $monto_destino = !empty($d['monto']) ? intval($d['monto']) : 0;\n        \n        \/\/ Si no hay monto en el JSON, intentar calcularlo\n        if ($monto_destino == 0 && !empty($origen_data['sector_id']) && !empty($d['sector_id'])) {\n            $precio = $wpdb->get_var($wpdb->prepare(\n                \"SELECT precio FROM tarifas WHERE origen_sector_id=%d AND destino_sector_id=%d\",\n                intval($origen_data['sector_id']),\n                intval($d['sector_id'])\n            ));\n            $monto_destino = $precio ? intval($precio) : 0;\n        }\n        \n        \/\/ Calcular recargos autom\u00e1ticos (fijos + variables)\n        $recargo_variable = $calcular_recargos_variables($monto_destino);\n        $recargo_automatico = $recargo_fijo_por_envio + $recargo_variable;\n        \n        \/\/ Obtener recargo seleccionable del JSON\n        $recargo_seleccionable_valor = !empty($d['recargo_seleccionable_valor']) ? intval($d['recargo_seleccionable_valor']) : 0;\n        $recargo_seleccionable_nombre = !empty($d['recargo_seleccionable_nombre']) ? $d['recargo_seleccionable_nombre'] : null;\n        $recargo_seleccionable_id = !empty($d['recargo_seleccionable_id']) ? intval($d['recargo_seleccionable_id']) : null;\n        \n        $total_trayecto = $monto_destino + $recargo_automatico + $recargo_seleccionable_valor;\n        \n        $detalle_envios[] = [\n            'id' => !empty($d['barrio_id']) ? intval($d['barrio_id']) : 0,\n            'nombre' => $nombre_destino,\n            'precio' => $monto_destino,\n            'recargo' => $recargo_automatico,\n            'recargo_seleccionable_valor' => $recargo_seleccionable_valor,\n            'recargo_seleccionable_nombre' => $recargo_seleccionable_nombre,\n            'recargo_seleccionable_id' => $recargo_seleccionable_id,\n            'total' => $total_trayecto,\n        ];\n        \n        $total_calculado += $total_trayecto;\n    }\n    \n    \/\/ Si no hay destinos con monto, usar el total del servicio dividido entre destinos\n    if ($total_calculado == 0 && !empty($detalle_envios) && $pedido->total > 0) {\n        $monto_por_destino = intval($pedido->total \/ count($detalle_envios));\n        foreach ($detalle_envios as &$de) {\n            $de['precio'] = $monto_por_destino;\n            $de['total'] = $monto_por_destino;\n        }\n        $total_calculado = $pedido->total;\n    }\n\n    \/* ==========================================================\n       4. Preparar mensaje para WhatsApp\n    ========================================================== *\/\n    \/\/ Detectar si es servicio intermunicipal\n    $es_intermunicipal = false;\n    if (!empty($json['tipo_servicio']) && $json['tipo_servicio'] === 'intermunicipal') {\n        $es_intermunicipal = true;\n    }\n    \n    $telefono_empresa = \"573194642513\"; \/\/ +57 319 4642513\n    \n    \/\/ Obtener datos del origen\n    $barrio_origen_nombre = '';\n    if (!empty($origen_data['barrio_nombre'])) {\n        $barrio_origen_nombre = $origen_data['barrio_nombre'];\n    } elseif (!empty($nombre_origen)) {\n        $barrio_origen_nombre = $nombre_origen;\n    }\n    \n    \/\/ Extraer direcci\u00f3n de recogida (sin el barrio si est\u00e1 incluido)\n    $direccion_recogida = $pedido->direccion_origen;\n    if (!empty($origen_data['direccion']) && $origen_data['direccion'] !== $pedido->direccion_origen) {\n        $direccion_recogida = $origen_data['direccion'];\n    }\n    \n    \/\/ Construir mensaje seg\u00fan el formato solicitado\n    if ($es_intermunicipal) {\n        \/\/ Mensaje para servicios intermunicipales\n        $destino_nombre = '';\n        if (!empty($destinos[0]['barrio_nombre'])) {\n            $destino_nombre = $destinos[0]['barrio_nombre'];\n        } elseif (!empty($destinos[0]['direccion'])) {\n            $destino_nombre = $destinos[0]['direccion'];\n        }\n        \n        $dir_destino_inter = !empty($destinos[0]['direccion']) ? trim($destinos[0]['direccion']) : '';\n        $barrio_destino_inter = !empty($destinos[0]['barrio_nombre']) ? trim($destinos[0]['barrio_nombre']) : '';\n        \n        $destino_display_inter = $dir_destino_inter ?: ($barrio_destino_inter ?: 'No especificado');\n        \n        $mensaje = urlencode(\n            \"\ud83d\ude9a Hola! He solicitado un servicio INTERMUNICIPAL en GoFast.\\n\\n\" .\n            \"\ud83d\udce6 Servicio: #$id\\n\" .\n            \"\ud83d\udccd Recogida: \" . ($direccion_recogida ?: 'No especificada') . \"\\n\" .\n            ($barrio_origen_nombre ? \"\ud83c\udfd9 Barrio: $barrio_origen_nombre\\n\" : \"\") .\n            \"\ud83d\udc64 Env\u00eda: \" . ($pedido->nombre_cliente ?: 'No especificado') . \"\\n\" .\n            \"\ud83d\udcde Contacto: \" . ($pedido->telefono_cliente ?: 'No especificado') . \"\\n\\n\" .\n            \"\ud83d\udcb2 Monto a pagar:\\n\" .\n            \"\ud83d\udcb0 Costo del env\u00edo: $\" . number_format($pedido->total, 0, ',', '.') . \"\\n\\n\" .\n            \"\ud83d\udeab IMPORTANTE:\\n\" .\n            \"Si ya no necesitas el servicio, recuerda cancelarlo antes de que el mensajero llegue al punto de recogida. En caso contrario, se aplicar\u00e1 un recargo por desplazamiento.\\n\\n\" .\n            \"\ud83d\udccd Destino: $destino_display_inter\\n\" .\n            ($barrio_destino_inter && $barrio_destino_inter !== $dir_destino_inter && $dir_destino_inter ? \"\ud83c\udfd9 Barrio: $barrio_destino_inter\\n\" : \"\")\n        );\n    } else {\n        \/\/ Mensaje para servicios normales (m\u00faltiples destinos posibles)\n        $mensaje_texto = \"\ud83d\ude80 Hola! He solicitado un servicio en GoFast.\\n\\n\";\n        $mensaje_texto .= \"\ud83d\udce6 Servicio: #$id\\n\";\n        $mensaje_texto .= \"\ud83d\udccd Recogida: \" . ($direccion_recogida ?: 'No especificada') . \"\\n\";\n        if ($barrio_origen_nombre) {\n            $mensaje_texto .= \"\ud83c\udfd9 Barrio: $barrio_origen_nombre\\n\";\n        }\n        $mensaje_texto .= \"\ud83d\udc64 Env\u00eda: \" . ($pedido->nombre_cliente ?: 'No especificado') . \"\\n\";\n        $mensaje_texto .= \"\ud83d\udcde Contacto: \" . ($pedido->telefono_cliente ?: 'No especificado') . \"\\n\\n\";\n        $mensaje_texto .= \"\ud83d\udcb2 Monto a pagar:\\n\";\n        $mensaje_texto .= \"\ud83d\udcb0 Costo del env\u00edo: $\" . number_format($pedido->total, 0, ',', '.') . \"\\n\\n\";\n        $mensaje_texto .= \"\ud83d\udeab IMPORTANTE:\\n\";\n        $mensaje_texto .= \"Si ya no necesitas el servicio, recuerda cancelarlo antes de que el mensajero llegue al punto de recogida. En caso contrario, se aplicar\u00e1 un recargo por desplazamiento.\\n\\n\";\n        \n        \/\/ Agregar informaci\u00f3n de cada destino\n        if (!empty($destinos)) {\n            foreach ($destinos as $idx => $dest) {\n                $dir_destino = !empty($dest['direccion']) ? trim($dest['direccion']) : '';\n                $barrio_destino = !empty($dest['barrio_nombre']) ? trim($dest['barrio_nombre']) : '';\n                \n                if ($idx > 0) {\n                    $mensaje_texto .= \"\\n\";\n                }\n                \n                \/\/ Destino: usar direcci\u00f3n si existe, sino el barrio\n                $destino_display = $dir_destino ?: ($barrio_destino ?: 'No especificado');\n                $mensaje_texto .= \"\ud83d\udccd Destino: $destino_display\\n\";\n                \n                \/\/ Barrio: solo mostrar si es diferente de la direcci\u00f3n\n                if ($barrio_destino && $barrio_destino !== $dir_destino && $dir_destino) {\n                    $mensaje_texto .= \"\ud83c\udfd9 Barrio: $barrio_destino\\n\";\n                } elseif ($barrio_destino && !$dir_destino) {\n                    \/\/ Si solo hay barrio, no duplicar en Destino y Barrio\n                    \/\/ Ya est\u00e1 en Destino, as\u00ed que no lo repetimos\n                }\n                \n                \/\/ Indicaciones: por ahora vac\u00edo, pero se puede agregar si hay un campo espec\u00edfico en el futuro\n                \/\/ Si en el futuro se agrega un campo 'indicaciones' al JSON, se mostrar\u00eda aqu\u00ed\n            }\n        } else {\n            \/\/ Si no hay destinos en el JSON, usar datos b\u00e1sicos\n            $mensaje_texto .= \"\ud83d\udccd Destino: No especificado\\n\";\n        }\n        \n        $mensaje = urlencode($mensaje_texto);\n    }\n\n    \/* ==========================================================\n       5. INTERFAZ VISUAL\n    ========================================================== *\/\n    ob_start();\n    ?>\n\n<div class=\"gofast-box\" style=\"max-width:650px;margin:25px auto;padding:20px;\">\n    <!-- \u26a0\ufe0f ALERTA IMPORTANTE -->\n    <div style=\"background:#fff9d6;border-left:5px solid #F4C524;padding:14px 16px;margin-bottom:25px;border-radius:8px;line-height:1.5;\">\n        <b>Importante:<\/b><br>\n        \u2022 Un coordinador te contactar\u00e1 pronto para asignar el mensajero.<br>\n        \u2022 Si deseas cancelar, hazlo lo antes posible.<br>\n        \u2022 Si ya fue asignado un mensajero, deber\u00e1s cubrir el valor del servicio.\n    <\/div>\n\n    <!-- \ud83d\udcac BOT\u00d3N PRINCIPAL -->\n    <div style=\"text-align:center;margin-bottom:30px;\">\n        <h2 style=\"margin-bottom:10px;font-weight:800;color:#25D366;\">\n            \u2705 \u00a1Servicio registrado con \u00e9xito!\n        <\/h2>\n        <p style=\"font-size:17px;margin-bottom:20px;\">\n            N\u00famero de servicio: <b>#<?= $pedido->id ?><\/b><br>\n            <span style=\"font-size:15px;\">Confirma tu pedido tocando el bot\u00f3n verde \ud83d\udc47<\/span>\n        <\/p>\n\n        <a id=\"btnWhatsApp\"\n           href=\"#\"\n           target=\"_blank\"\n           style=\"display:inline-block;background:#25D366;color:white;font-size:20px;font-weight:800;padding:18px 36px;border-radius:12px;text-decoration:none;box-shadow:0 4px 8px rgba(0,0,0,0.15);transition:all .2s ease;\">\n           \ud83d\udcac Confirmar por WhatsApp\n        <\/a>\n\n        <p style=\"margin-top:12px;color:#555;font-size:14px;\">\n            Si no se abre autom\u00e1ticamente, toca el bot\u00f3n de nuevo.\n        <\/p>\n    <\/div>\n\n    <!-- \ud83d\udccd RESUMEN DEL SERVICIO (Estilo mensajero) -->\n    <div class=\"gofast-checkout-wrapper\" style=\"margin-top:25px;\">\n        <div class=\"gofast-box\" style=\"max-width:800px;margin:0 auto;\">\n            \n            <div style=\"background:#e3f2fd;border-left:4px solid #2196F3;padding:12px;margin-bottom:20px;border-radius:8px;\">\n                <strong>\ud83d\ude9a Resumen del Servicio<\/strong><br>\n                <small>Detalle de tu pedido registrado.<\/small>\n            <\/div>\n\n            <?php if (!empty($nombre_origen)): ?>\n                <h3 style=\"margin-top:0;\">\ud83d\udccd Origen: <?= esc_html($nombre_origen) ?><\/h3>\n            <?php endif; ?>\n\n            <div id=\"destinos-resumen\">\n                <?php if (!empty($detalle_envios)): ?>\n                    <?php foreach ($detalle_envios as $idx => $d): ?>\n                        <div class=\"gofast-destino-resumen-item\" \n                             data-destino-id=\"<?= esc_attr($d['id']) ?>\"\n                             data-precio=\"<?= esc_attr($d['precio']) ?>\"\n                             data-recargo=\"<?= esc_attr($d['recargo']) ?>\"\n                             data-total=\"<?= esc_attr($d['total']) ?>\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;padding:12px;background:#f8f9fa;border-radius:8px;margin-bottom:10px;border-left:4px solid #F4C524;\">\n                                <div style=\"flex:1;\">\n                                    <strong>\ud83c\udfaf <?= esc_html($d['nombre']) ?><\/strong>\n                                    <?php if (!empty($d['recargo_seleccionable_id']) && !empty($d['recargo_seleccionable_valor'])): ?>\n                                        <span style=\"background:#4CAF50;color:#fff;padding:2px 8px;border-radius:12px;font-size:11px;margin-left:8px;font-weight:normal;\">\n                                            \u2b50 Con recargo adicional\n                                        <\/span>\n                                    <?php endif; ?>\n                                    <br>\n                                    <?php if ($d['precio'] > 0): ?>\n                                        <small style=\"color:#666;\">\n                                            Base: $<?= number_format($d['precio'], 0, ',', '.') ?>\n                                            <?php if ($d['recargo'] > 0): ?>\n                                                | Recargo autom\u00e1tico: $<?= number_format($d['recargo'], 0, ',', '.') ?>\n                                            <?php endif; ?>\n                                            <?php if (!empty($d['recargo_seleccionable_id']) && !empty($d['recargo_seleccionable_valor'])): ?>\n                                                | <strong style=\"color:#4CAF50;\">Recargo adicional: $<?= number_format($d['recargo_seleccionable_valor'], 0, ',', '.') ?><\/strong>\n                                                <?php if (!empty($d['recargo_seleccionable_nombre'])): ?>\n                                                    <span style=\"color:#666;\">(<?= esc_html($d['recargo_seleccionable_nombre']) ?>)<\/span>\n                                                <?php endif; ?>\n                                            <?php endif; ?>\n                                        <\/small><br>\n                                    <?php endif; ?>\n                                    <?php if ($d['total'] > 0): ?>\n                                        <strong style=\"color:#4CAF50;font-size:18px;\">\n                                            $<?= number_format($d['total'], 0, ',', '.') ?>\n                                        <\/strong>\n                                    <?php endif; ?>\n                                <\/div>\n                            <\/div>\n                        <\/div>\n                    <?php endforeach; ?>\n                <?php else: ?>\n                    <p style=\"color:#666;\">(No se registraron destinos)<\/p>\n                <?php endif; ?>\n            <\/div>\n\n            <div class=\"gofast-total-box\" style=\"margin:20px 0;text-align:center;\" id=\"total-box\">\n                \ud83d\udcb0 <strong style=\"font-size:24px;\" id=\"total-amount\">Total: $<?= number_format($pedido->total > 0 ? $pedido->total : $total_calculado, 0, ',', '.') ?><\/strong>\n            <\/div>\n\n        <\/div>\n    <\/div>\n\n    <!-- \ud83d\udc64 RESUMEN DEL CLIENTE -->\n    <div style=\"margin-top:25px;background:#fafafa;border-radius:10px;padding:14px 18px;line-height:1.6;font-size:15px;\">\n        <h3 style=\"margin-top:0;font-size:17px;\">\ud83d\udc64 Detalle del cliente<\/h3>\n        <p><strong>Nombre:<\/strong> <?= esc_html($pedido->nombre_cliente) ?><\/p>\n        <p><strong>Tel\u00e9fono:<\/strong> <?= esc_html($pedido->telefono_cliente) ?><\/p>\n        <p><strong>Direcci\u00f3n origen:<\/strong> <?= esc_html($pedido->direccion_origen) ?><\/p>\n        <p><strong>Total:<\/strong> $<?= number_format($pedido->total, 0) ?><\/p>\n        <p><strong>Estado:<\/strong> <?= ucfirst($pedido->tracking_estado) ?><\/p>\n    <\/div>\n\n    <!-- \ud83d\udd04 BOTONES INFERIORES -->\n    <div class=\"gofast-btn-group\" style=\"margin-top:25px;text-align:center;\">\n        <?php \n        \/\/ Determinar si es intermunicipal para redirigir al cotizador correcto\n        $es_intermunicipal = false;\n        if (!empty($json['tipo_servicio']) && $json['tipo_servicio'] === 'intermunicipal') {\n            $es_intermunicipal = true;\n        }\n        $url_cotizar = $es_intermunicipal \n            ? esc_url( home_url('\/cotizar-intermunicipal') )\n            : esc_url( home_url('\/cotizar') );\n        ?>\n        <a href=\"<?php echo $url_cotizar; ?>\" class=\"gofast-btn-action\">\ud83d\udd04 Hacer otra cotizaci\u00f3n<\/a>\n        <?php if (!empty($_SESSION[\"gofast_user_id\"]) && empty($_SESSION[\"gofast_auto_linked\"])): ?>\n            <a href=\"<?php echo esc_url( home_url('\/mis-pedidos') ); ?>\" class=\"gofast-btn-action gofast-secondary\">\ud83d\udce6 Ver mis pedidos<\/a>\n        <?php else: ?>\n            <a href=\"<?php echo esc_url( home_url('\/auth\/?registro=1') ); ?>\" class=\"gofast-btn-action gofast-secondary\">\ud83d\udc64 Crear cuenta para ver tus pedidos<\/a>\n        <?php endif; ?>\n    <\/div>\n\n<\/div>\n\n<script>\n(function() {\n    \/\/ Proteger contra errores de toggleOtro si se ejecuta desde otro archivo\n    const tipoSelectExists = document.getElementById(\"tipo_negocio\");\n    const wrapperOtroExists = document.getElementById(\"tipo_otro_wrapper\");\n    \n    \/\/ Si los elementos no existen, crear una funci\u00f3n segura desde el inicio\n    if (!tipoSelectExists || !wrapperOtroExists) {\n        if (typeof window.toggleOtro === 'undefined') {\n            window.toggleOtro = function() {\n                \/\/ Funci\u00f3n vac\u00eda segura - no hacer nada\n                return;\n            };\n        } else if (typeof window.toggleOtro === 'function') {\n            \/\/ Si existe y los elementos no est\u00e1n presentes, proteger la funci\u00f3n\n            const originalToggleOtro = window.toggleOtro;\n            window.toggleOtro = function() {\n                try {\n                    const tipoSelect = document.getElementById(\"tipo_negocio\");\n                    const wrapperOtro = document.getElementById(\"tipo_otro_wrapper\");\n                    if (tipoSelect && wrapperOtro && tipoSelect.parentNode && wrapperOtro.parentNode) {\n                        return originalToggleOtro();\n                    }\n                } catch(e) {\n                    \/\/ Silenciar error completamente\n                    return;\n                }\n            };\n        }\n    }\n    \n    \/\/ Tambi\u00e9n prevenir que setTimeout ejecute toggleOtro si no est\u00e1n los elementos\n    (function() {\n        const originalSetTimeout = window.setTimeout;\n        window.setTimeout = function(func, delay) {\n            if (typeof func === 'function') {\n                try {\n                    const funcStr = func.toString();\n                    if (funcStr.includes('toggleOtro')) {\n                        const tipoSelect = document.getElementById(\"tipo_negocio\");\n                        const wrapperOtro = document.getElementById(\"tipo_otro_wrapper\");\n                        if (!tipoSelect || !wrapperOtro) {\n                            \/\/ Retornar un timeout vac\u00edo en lugar de null para evitar errores\n                            return originalSetTimeout(function() {}, 0);\n                        }\n                    }\n                } catch(e) {\n                    \/\/ Si hay alg\u00fan error al verificar, continuar normalmente\n                }\n            }\n            return originalSetTimeout.apply(this, arguments);\n        };\n    })();\n})();\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    const btn = document.getElementById(\"btnWhatsApp\");\n    const phone = \"<?= $telefono_empresa ?>\";\n    const msg = \"<?= $mensaje ?>\";\n    const isMobile = \/Android|iPhone|iPad|iPod\/i.test(navigator.userAgent);\n\n    const url = isMobile\n        ? `https:\/\/wa.me\/${phone}?text=${msg}`\n        : `https:\/\/web.whatsapp.com\/send?phone=${phone}&text=${msg}`;\n\n    if (btn) {\n        btn.href = url;\n    }\n\n    setTimeout(() => {\n        if (!document.hidden) {\n            alert(\"Si WhatsApp no se abri\u00f3 autom\u00e1ticamente, toca el bot\u00f3n verde para confirmar tu pedido.\");\n        }\n    }, 5000);\n});\n<\/script>\n\n<?php\n    return ob_get_clean();\n});\n\n","active":true,"modified":"2025-12-11 02:41:15","revision":"1"}]}