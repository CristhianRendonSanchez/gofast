{"generator":"Code Snippets v3.9.3","date_created":"2025-12-12 19:47","snippets":[{"id":22,"name":"gofast_recargos_admin","code":"\n\/***************************************************\n * GOFAST \u2013 ADMIN RECARGOS (shortcode)\n * [gofast_recargos_admin]\n ***************************************************\/\nfunction gofast_recargos_admin_shortcode() {\n    if (session_status() === PHP_SESSION_NONE) {\n        session_start();\n    }\n\n    global $wpdb;\n\n    $tabla_recargos = 'recargos';\n    $tabla_rangos   = 'recargos_rangos';\n\n    $mensaje = '';\n    $advertencia_tipo = '';\n\n    \/\/ Verificar si el tipo 'por_volumen_peso' est\u00e1 disponible en la base de datos\n    $tipos_disponibles = $wpdb->get_col(\"SHOW COLUMNS FROM {$tabla_recargos} WHERE Field = 'tipo'\");\n    $tipo_enum = '';\n    if (!empty($tipos_disponibles)) {\n        $columna_info = $wpdb->get_row(\"SHOW COLUMNS FROM {$tabla_recargos} WHERE Field = 'tipo'\");\n        if ($columna_info && !empty($columna_info->Type)) {\n            $tipo_enum = $columna_info->Type;\n        }\n    }\n    \n    if (!empty($tipo_enum) && strpos($tipo_enum, 'por_volumen_peso') === false) {\n        $advertencia_tipo = \"<div style='background:#fff3cd;border-left:4px solid #ffc107;padding:16px;border-radius:8px;margin-bottom:20px;'>\";\n        $advertencia_tipo .= \"\u26a0\ufe0f <strong>Advertencia:<\/strong> El tipo de recargo 'por_volumen_peso' no est\u00e1 disponible en la base de datos. \";\n        $advertencia_tipo .= \"Por favor ejecuta el script SQL: <code>db\/recargos_alter_volumen_peso.sql<\/code>\";\n        $advertencia_tipo .= \"<\/div>\";\n    }\n\n    \/* ==========================================================\n       0. Validar usuario admin\n    ========================================================== *\/\n    $usuario = null;\n    if (!empty($_SESSION['gofast_user_id'])) {\n        $uid = (int) $_SESSION['gofast_user_id'];\n        $usuario = $wpdb->get_row(\n            $wpdb->prepare(\n                \"SELECT id, nombre, rol, activo \n                 FROM usuarios_gofast \n                 WHERE id = %d AND activo = 1\",\n                $uid\n            )\n        );\n    }\n\n    if (!$usuario || strtolower($usuario->rol) !== 'admin') {\n        return \"<div class='gofast-box'>\n                    \u26a0\ufe0f Solo los administradores pueden gestionar recargos.\n                <\/div>\";\n    }\n\n    \/* ==========================================================\n       1. Procesar POST (crear, editar, eliminar)\n    ========================================================== *\/\n    if ($_SERVER['REQUEST_METHOD'] === 'POST') {\n\n        \/\/ Verificar nonce\n        $nonce_valido = false;\n        $nonce_recibido = isset($_POST['gofast_recargos_nonce']) ? $_POST['gofast_recargos_nonce'] : '';\n        \n        if (!empty($nonce_recibido)) {\n            $nonce_valido = wp_verify_nonce($nonce_recibido, 'gofast_recargos_admin');\n        }\n        \n        \/\/ Si no hay nonce v\u00e1lido y hay POST, mostrar error\n        if (!$nonce_valido && !empty($_POST)) {\n            $mensaje = \"<div style='background:#f8d7da;border-left:4px solid #dc3545;padding:16px;border-radius:8px;'>\";\n            $mensaje .= \"\ud83d\udd12 <strong>Error de seguridad:<\/strong> El nonce no es v\u00e1lido. \";\n            $mensaje .= \"Por favor, recarga la p\u00e1gina e intenta de nuevo.\";\n            $mensaje .= \"<\/div>\";\n        }\n\n        \/* ----------------------------------------------\n           A) Crear nuevo recargo FIJO\n        ---------------------------------------------- *\/\n        if (isset($_POST['gofast_crear_fijo']) && $_POST['gofast_crear_fijo'] == '1') {\n            if (!$nonce_valido) {\n                $mensaje = \"<div style='background:#f8d7da;border-left:4px solid #dc3545;padding:16px;border-radius:8px;'>\";\n                $mensaje .= \"\ud83d\udd12 <strong>Error de seguridad:<\/strong> El nonce no es v\u00e1lido. \";\n                $mensaje .= \"Por favor, recarga la p\u00e1gina e intenta de nuevo.\";\n                $mensaje .= \"<\/div>\";\n            } else {\n                $nombre     = sanitize_text_field($_POST['nuevo_fijo_nombre'] ?? '');\n                $valor_fijo = (int) ($_POST['nuevo_fijo_valor'] ?? 0);\n                $activo     = !empty($_POST['nuevo_fijo_activo']) ? 1 : 0;\n\n            if ($nombre !== '' && $valor_fijo > 0) {\n                \/\/ Generar slug \u00fanico\n                $slug_base = sanitize_title($nombre);\n                if (empty($slug_base)) {\n                    $slug_base = 'recargo-' . time();\n                }\n                $slug = $slug_base;\n                $contador = 1;\n                while ($wpdb->get_var($wpdb->prepare(\"SELECT COUNT(*) FROM {$tabla_recargos} WHERE slug = %s\", $slug)) > 0) {\n                    $slug = $slug_base . '-' . $contador;\n                    $contador++;\n                }\n\n                $slug = substr($slug, 0, 50);\n                if (empty($slug)) {\n                    $slug = 'recargo-' . time();\n                }\n\n                $ok = $wpdb->insert($tabla_recargos, [\n                    'slug'       => $slug,\n                    'nombre'     => $nombre,\n                    'tipo'       => 'fijo',\n                    'valor_fijo' => $valor_fijo,\n                    'activo'     => $activo,\n                ], [\n                    '%s', '%s', '%s', '%d', '%d'\n                ]);\n\n                if ($ok !== false) {\n                    \/\/ Guardar mensaje y redirigir con JavaScript (no se puede usar wp_safe_redirect en shortcode)\n                    $redirect_url = add_query_arg([\n                        'mensaje' => 'recargo_fijo_creado',\n                        'tab' => 'fijos'\n                    ], remove_query_arg(['mensaje', 'tab'], $_SERVER['REQUEST_URI']));\n                    echo '<script>window.location.href = \"' . esc_js($redirect_url) . '\";<\/script>';\n                    return '';\n                } else {\n                    $error_msg = $wpdb->last_error ?: 'Error desconocido al insertar en la base de datos';\n                    $mensaje = \"\u274c Error al crear recargo fijo: \" . esc_html($error_msg);\n                }\n                } else {\n                    $mensaje = \"\u26a0\ufe0f Debes indicar nombre y valor fijo mayor a 0.\";\n                }\n            }\n        }\n\n        \/* ----------------------------------------------\n           B) Crear nuevo recargo POR VALOR + rangos\n        ---------------------------------------------- *\/\n        if (isset($_POST['gofast_crear_variable']) && $_POST['gofast_crear_variable'] == '1') {\n            if (!$nonce_valido) {\n                $mensaje = \"<div style='background:#f8d7da;border-left:4px solid #dc3545;padding:16px;border-radius:8px;'>\";\n                $mensaje .= \"\ud83d\udd12 <strong>Error de seguridad:<\/strong> El nonce no es v\u00e1lido. \";\n                $mensaje .= \"Por favor, recarga la p\u00e1gina e intenta de nuevo.\";\n                $mensaje .= \"<\/div>\";\n            } else {\n            $nombre = sanitize_text_field($_POST['nuevo_var_nombre'] ?? '');\n            $activo = !empty($_POST['nuevo_var_activo']) ? 1 : 0;\n\n            $mins   = $_POST['nuevo_var_rango_min']   ?? [];\n            $maxs   = $_POST['nuevo_var_rango_max']   ?? [];\n            $valors = $_POST['nuevo_var_rango_valor'] ?? [];\n\n            if ($nombre === '') {\n                $mensaje = \"\u26a0\ufe0f Debes indicar un nombre para el recargo variable.\";\n            } else {\n                \/\/ Generar slug \u00fanico\n                $slug_base = sanitize_title($nombre);\n                if (empty($slug_base)) {\n                    $slug_base = 'recargo-' . time();\n                }\n                $slug = $slug_base;\n                $contador = 1;\n                while ($wpdb->get_var($wpdb->prepare(\"SELECT COUNT(*) FROM {$tabla_recargos} WHERE slug = %s\", $slug)) > 0) {\n                    $slug = $slug_base . '-' . $contador;\n                    $contador++;\n                }\n\n                $slug = substr($slug, 0, 50);\n                if (empty($slug)) {\n                    $slug = 'recargo-' . time();\n                }\n\n                $ok = $wpdb->insert($tabla_recargos, [\n                    'slug'       => $slug,\n                    'nombre'     => $nombre,\n                    'tipo'       => 'por_valor',\n                    'valor_fijo' => 0,\n                    'activo'     => $activo,\n                ], [\n                    '%s', '%s', '%s', '%d', '%d'\n                ]);\n\n                if ($ok === false) {\n                    $mensaje = \"\u274c Error al crear recargo variable: \" . esc_html($wpdb->last_error);\n                } else {\n                    $recargo_id = (int) $wpdb->insert_id;\n\n                    \/\/ Insertar rangos iniciales\n                    if (!empty($mins) && is_array($mins)) {\n                        foreach ($mins as $idx => $min) {\n                            $min   = (int) ($mins[$idx]   ?? 0);\n                            $max   = (int) ($maxs[$idx]   ?? 0);\n                            $rec   = (int) ($valors[$idx] ?? 0);\n\n                            if ($rec <= 0) continue;\n\n                            $wpdb->insert($tabla_rangos, [\n                                'recargo_id' => $recargo_id,\n                                'monto_min'  => $min,\n                                'monto_max'  => $max,\n                                'recargo'    => $rec,\n                            ], [\n                                '%d', '%d', '%d', '%d'\n                            ]);\n                        }\n                    }\n\n                    \/\/ Guardar mensaje y redirigir con JavaScript\n                    $redirect_url = add_query_arg([\n                        'mensaje' => 'recargo_por_valor_creado',\n                        'tab' => 'por_valor'\n                    ], remove_query_arg(['mensaje', 'tab'], $_SERVER['REQUEST_URI']));\n                    echo '<script>window.location.href = \"' . esc_js($redirect_url) . '\";<\/script>';\n                    return '';\n                }\n            }\n            }\n        }\n\n        \/* ----------------------------------------------\n           B2) Crear nuevo recargo FIJO por volumen y peso\n        ---------------------------------------------- *\/\n        if (isset($_POST['gofast_crear_volumen_peso']) && $_POST['gofast_crear_volumen_peso'] == '1') {\n            if (!$nonce_valido) {\n                $mensaje = \"<div style='background:#f8d7da;border-left:4px solid #dc3545;padding:16px;border-radius:8px;'>\";\n                $mensaje .= \"\ud83d\udd12 <strong>Error de seguridad:<\/strong> El nonce no es v\u00e1lido. \";\n                $mensaje .= \"Por favor, recarga la p\u00e1gina e intenta de nuevo.\";\n                $mensaje .= \"<\/div>\";\n            } else {\n            $nombre     = sanitize_text_field($_POST['nuevo_vp_nombre'] ?? '');\n            $valor_fijo = (int) ($_POST['nuevo_vp_valor'] ?? 0);\n            $activo     = !empty($_POST['nuevo_vp_activo']) ? 1 : 0;\n\n            if ($nombre !== '' && $valor_fijo > 0) {\n                \/\/ Verificar que el tipo est\u00e9 disponible\n                $tipos_disponibles = $wpdb->get_row(\"SHOW COLUMNS FROM {$tabla_recargos} WHERE Field = 'tipo'\");\n                $tipo_disponible = false;\n                if ($tipos_disponibles && !empty($tipos_disponibles->Type)) {\n                    $tipo_disponible = (strpos($tipos_disponibles->Type, 'por_volumen_peso') !== false);\n                }\n                \n                if (!$tipo_disponible) {\n                    $mensaje = \"\u274c <strong>Error:<\/strong> El tipo 'por_volumen_peso' no est\u00e1 disponible en la base de datos. \";\n                    $mensaje .= \"Por favor ejecuta el script SQL: <code>db\/recargos_alter_volumen_peso.sql<\/code>\";\n                } else {\n                    \/\/ Generar slug \u00fanico\n                    $slug_base = sanitize_title($nombre);\n                    if (empty($slug_base)) {\n                        $slug_base = 'recargo-' . time();\n                    }\n                    $slug = $slug_base;\n                    $contador = 1;\n                    while ($wpdb->get_var($wpdb->prepare(\"SELECT COUNT(*) FROM {$tabla_recargos} WHERE slug = %s\", $slug)) > 0) {\n                        $slug = $slug_base . '-' . $contador;\n                        $contador++;\n                    }\n\n                    $slug = substr($slug, 0, 50);\n                    if (empty($slug)) {\n                        $slug = 'recargo-' . time();\n                    }\n\n                    $ok = $wpdb->insert($tabla_recargos, [\n                        'slug'       => $slug,\n                        'nombre'     => $nombre,\n                        'tipo'       => 'por_volumen_peso',\n                        'valor_fijo' => $valor_fijo,\n                        'activo'     => $activo,\n                    ], [\n                        '%s', '%s', '%s', '%d', '%d'\n                    ]);\n\n                    if ($ok !== false) {\n                        \/\/ Guardar mensaje y redirigir con JavaScript\n                        $redirect_url = add_query_arg([\n                            'mensaje' => 'recargo_seleccionable_creado',\n                            'tab' => 'seleccionables'\n                        ], remove_query_arg(['mensaje', 'tab'], $_SERVER['REQUEST_URI']));\n                        echo '<script>window.location.href = \"' . esc_js($redirect_url) . '\";<\/script>';\n                        return '';\n                    } else {\n                        $error_msg = $wpdb->last_error ?: 'Error desconocido al insertar en la base de datos';\n                        $mensaje = \"\u274c Error al crear recargo: \" . esc_html($error_msg);\n                    }\n                }\n                } else {\n                    $mensaje = \"\u26a0\ufe0f Debes indicar nombre y valor fijo mayor a 0.\";\n                }\n            }\n        }\n\n        \/* ----------------------------------------------\n           C) Editar \/ eliminar recargos + rangos\n        ---------------------------------------------- *\/\n        if (isset($_POST['gofast_guardar_recargos']) && $_POST['gofast_guardar_recargos'] !== '' && !isset($_POST['gofast_crear_fijo']) && !isset($_POST['gofast_crear_variable']) && !isset($_POST['gofast_crear_volumen_peso'])) {\n            if (!$nonce_valido) {\n                $mensaje = \"<div style='background:#f8d7da;border-left:4px solid #dc3545;padding:16px;border-radius:8px;'>\";\n                $mensaje .= \"\ud83d\udd12 <strong>Error de seguridad:<\/strong> El nonce no es v\u00e1lido. \";\n                $mensaje .= \"Por favor, recarga la p\u00e1gina e intenta de nuevo.\";\n                $mensaje .= \"<\/div>\";\n            } else {\n\n            \/\/ 1) Eliminar RANGOS seleccionados\n            if (!empty($_POST['eliminar_rango']) && is_array($_POST['eliminar_rango'])) {\n                foreach ($_POST['eliminar_rango'] as $rid => $flag) {\n                    if ($flag != '1') continue;\n                    $rid = (int) $rid;\n                    if ($rid > 0) {\n                        $wpdb->delete($tabla_rangos, ['id' => $rid], ['%d']);\n                    }\n                }\n            }\n\n            \/\/ 2) Eliminar RECARGOS seleccionados (y sus rangos)\n            if (!empty($_POST['eliminar_recargo']) && is_array($_POST['eliminar_recargo'])) {\n                foreach ($_POST['eliminar_recargo'] as $rid => $flag) {\n                    if ($flag != '1') continue;\n                    $rid = (int) $rid;\n                    if ($rid > 0) {\n                        $wpdb->delete($tabla_rangos, ['recargo_id' => $rid], ['%d']);\n                        $wpdb->delete($tabla_recargos, ['id' => $rid], ['%d']);\n                    }\n                }\n            }\n\n            \/\/ 3) Actualizar recargos existentes\n            if (!empty($_POST['recargos']) && is_array($_POST['recargos'])) {\n                foreach ($_POST['recargos'] as $rid => $data) {\n                    $rid = (int) $rid;\n                    if ($rid <= 0) continue;\n\n                    $activo     = !empty($data['activo']) ? 1 : 0;\n                    $nombre     = sanitize_text_field($data['nombre'] ?? '');\n                    $tipo       = $data['tipo'] ?? 'fijo';\n                    $valor_fijo = (int) ($data['valor_fijo'] ?? 0);\n\n                    $update_data = [\n                        'activo' => $activo,\n                        'nombre' => $nombre,\n                    ];\n\n                    if ($tipo === 'fijo' || $tipo === 'por_volumen_peso') {\n                        $update_data['valor_fijo'] = $valor_fijo;\n                    }\n\n                    $wpdb->update(\n                        $tabla_recargos,\n                        $update_data,\n                        ['id' => $rid],\n                        ['%d', '%s', '%d'],\n                        ['%d']\n                    );\n                }\n            }\n\n            \/\/ 4) Actualizar rangos existentes\n            if (!empty($_POST['rangos']) && is_array($_POST['rangos'])) {\n                foreach ($_POST['rangos'] as $recargo_id => $rangos) {\n                    foreach ($rangos as $rango_id => $datos) {\n                        $rango_id = (int) $rango_id;\n                        if ($rango_id <= 0) continue;\n\n                        $min = (int) ($datos['min']   ?? 0);\n                        $max = (int) ($datos['max']   ?? 0);\n                        $rec = (int) ($datos['valor'] ?? 0);\n\n                        $wpdb->update(\n                            $tabla_rangos,\n                            [\n                                'monto_min' => $min,\n                                'monto_max' => $max,\n                                'recargo'   => $rec,\n                            ],\n                            ['id' => $rango_id],\n                            ['%d', '%d', '%d'],\n                            ['%d']\n                        );\n                    }\n                }\n            }\n\n            \/\/ 5) Nuevos rangos para recargos existentes\n            if (!empty($_POST['nuevos_rangos']) && is_array($_POST['nuevos_rangos'])) {\n                foreach ($_POST['nuevos_rangos'] as $recargo_id => $datos) {\n                    $recargo_id = (int) $recargo_id;\n                    if ($recargo_id <= 0) continue;\n\n                    $mins   = $datos['min']   ?? [];\n                    $maxs   = $datos['max']   ?? [];\n                    $valors = $datos['valor'] ?? [];\n\n                    if (!is_array($mins)) continue;\n\n                    foreach ($mins as $idx => $min) {\n                        $min = (int) ($mins[$idx]   ?? 0);\n                        $max = (int) ($maxs[$idx]   ?? 0);\n                        $rec = (int) ($valors[$idx] ?? 0);\n\n                        if ($rec <= 0) continue;\n\n                        $wpdb->insert($tabla_rangos, [\n                            'recargo_id' => $recargo_id,\n                            'monto_min'  => $min,\n                            'monto_max'  => $max,\n                            'recargo'    => $rec,\n                        ], [\n                            '%d', '%d', '%d', '%d'\n                        ]);\n                    }\n                }\n            }\n\n                if ($mensaje === '') {\n                    $mensaje = \"<div style='background:#d4edda;border-left:4px solid #28a745;padding:16px;border-radius:8px;'>\";\n                    $mensaje .= \"\u2705 Cambios guardados correctamente.\";\n                    $mensaje .= \"<\/div>\";\n                }\n            }\n        }\n    }\n\n    \/* ==========================================================\n       1.5. Mostrar mensajes de \u00e9xito desde URL\n    ========================================================== *\/\n    if (isset($_GET['mensaje'])) {\n        $mensaje_get = sanitize_text_field($_GET['mensaje']);\n        if ($mensaje_get === 'recargo_fijo_creado') {\n            $mensaje = \"<div style='background:#d4edda;border-left:4px solid #28a745;padding:16px;border-radius:8px;'>\";\n            $mensaje .= \"\u2705 Recargo fijo creado correctamente.\";\n            $mensaje .= \"<\/div>\";\n        } elseif ($mensaje_get === 'recargo_por_valor_creado') {\n            $mensaje = \"<div style='background:#d4edda;border-left:4px solid #28a745;padding:16px;border-radius:8px;'>\";\n            $mensaje .= \"\u2705 Recargo por valor creado correctamente.\";\n            $mensaje .= \"<\/div>\";\n        } elseif ($mensaje_get === 'recargo_seleccionable_creado') {\n            $mensaje = \"<div style='background:#d4edda;border-left:4px solid #28a745;padding:16px;border-radius:8px;'>\";\n            $mensaje .= \"\u2705 Recargo seleccionable creado correctamente.\";\n            $mensaje .= \"<\/div>\";\n        }\n    }\n\n    \/* ==========================================================\n       2. Cargar recargos + rangos actuales\n    ========================================================== *\/\n    $recargos = $wpdb->get_results(\"\n        SELECT * FROM {$tabla_recargos}\n        ORDER BY tipo ASC, nombre ASC\n    \");\n\n    $recargos_fijos    = [];\n    $recargos_var      = [];\n    $recargos_vp       = [];\n    $rangos_por_recargo = [];\n\n    if ($recargos) {\n        foreach ($recargos as $r) {\n            if ($r->tipo === 'por_valor') {\n                $recargos_var[] = $r;\n            } elseif ($r->tipo === 'por_volumen_peso') {\n                $recargos_vp[] = $r;\n            } else {\n                $recargos_fijos[] = $r;\n            }\n        }\n\n        \/\/ Cargar rangos para recargos por valor\n        if (!empty($recargos_var)) {\n            $ids = implode(',', array_map('intval', wp_list_pluck($recargos_var, 'id')));\n            $rangos = $wpdb->get_results(\"\n                SELECT * FROM {$tabla_rangos}\n                WHERE recargo_id IN ($ids)\n                ORDER BY recargo_id ASC, monto_min ASC\n            \");\n\n            foreach ($rangos as $rg) {\n                $rangos_por_recargo[$rg->recargo_id][] = $rg;\n            }\n        }\n    }\n\n    \/* ==========================================================\n       3. HTML\n    ========================================================== *\/\n    $tab_activo = isset($_GET['tab']) ? sanitize_text_field($_GET['tab']) : 'fijos';\n    \n    ob_start();\n    ?>\n\n<div class=\"gofast-home\">\n    <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:12px;\">\n        <div>\n            <h1 style=\"margin-bottom:8px;\">\u2699\ufe0f Administraci\u00f3n de recargos<\/h1>\n            <p class=\"gofast-home-text\" style=\"margin:0;\">\n                Define recargos fijos y por valor que se aplican autom\u00e1ticamente a las cotizaciones.\n            <\/p>\n        <\/div>\n        <a href=\"<?php echo esc_url( home_url('\/dashboard-admin') ); ?>\" class=\"gofast-btn-request\" style=\"text-decoration:none;white-space:nowrap;\">\n            \u2190 Volver al Dashboard\n        <\/a>\n    <\/div>\n\n    <?php if ($advertencia_tipo): ?>\n        <div class=\"gofast-box\" style=\"margin-bottom:15px;\">\n            <?= $advertencia_tipo; ?>\n        <\/div>\n    <?php endif; ?>\n    \n    <?php if ($mensaje): ?>\n        <div class=\"gofast-box\" style=\"margin-bottom:15px;\">\n            <?= $mensaje; ?>\n        <\/div>\n    <?php endif; ?>\n\n    <!-- Tabs de navegaci\u00f3n -->\n    <div class=\"gofast-box\" style=\"margin-bottom: 20px;\">\n        <div style=\"display: flex; gap: 8px; flex-wrap: wrap; border-bottom: 2px solid #ddd; margin-bottom: 20px;\">\n            <button type=\"button\" \n                    class=\"gofast-config-tab <?= $tab_activo === 'fijos' ? 'gofast-config-tab-active' : '' ?>\"\n                    onclick=\"mostrarTabRecargos('fijos')\">\n                \ud83d\udcb0 Recargos Fijos\n            <\/button>\n            <button type=\"button\" \n                    class=\"gofast-config-tab <?= $tab_activo === 'por_valor' ? 'gofast-config-tab-active' : '' ?>\"\n                    onclick=\"mostrarTabRecargos('por_valor')\">\n                \ud83d\udcca Recargos por Valor\n            <\/button>\n            <button type=\"button\" \n                    class=\"gofast-config-tab <?= $tab_activo === 'seleccionables' ? 'gofast-config-tab-active' : '' ?>\"\n                    onclick=\"mostrarTabRecargos('seleccionables')\">\n                \u2705 Recargos Seleccionables\n            <\/button>\n        <\/div>\n\n        <form method=\"post\">\n            <?php wp_nonce_field('gofast_recargos_admin', 'gofast_recargos_nonce'); ?>\n\n            <!-- TAB: RECARGOS FIJOS -->\n            <div id=\"tab-recargos-fijos\" class=\"gofast-config-tab-content\" style=\"display: <?= $tab_activo === 'fijos' ? 'block' : 'none' ?>;\">\n                <h3 style=\"margin-top:0;\">\ud83d\udcb0 Recargos Fijos<\/h3>\n                <p style=\"font-size:13px;color:#666;margin:8px 0 16px;\">\n                    Estos recargos se aplican autom\u00e1ticamente con un valor fijo a todas las cotizaciones.\n                <\/p>\n\n                <!-- Formulario crear recargo fijo -->\n                <div class=\"gofast-box\" style=\"background: #f8f9fa; margin-bottom: 20px;\">\n                    <h4 style=\"margin-top: 0;\">\u2795 Crear Nuevo Recargo Fijo<\/h4>\n                    <div class=\"gofast-recargo-nuevo\">\n                        <div>\n                            <label>Nombre del recargo<\/label>\n                            <input type=\"text\" name=\"nuevo_fijo_nombre\" placeholder=\"Ej: Recargo nocturno\" \/>\n                        <\/div>\n                        <div>\n                            <label>Valor fijo (COP)<\/label>\n                            <input type=\"number\" name=\"nuevo_fijo_valor\" placeholder=\"Ej: 2000\" min=\"0\" \/>\n                        <\/div>\n                        <div style=\"display:flex;align-items:flex-end;\">\n                            <label class=\"gofast-switch\">\n                                <input type=\"checkbox\" name=\"nuevo_fijo_activo\" value=\"1\" checked>\n                                <span class=\"gofast-switch-slider\"><\/span>\n                                <span class=\"gofast-switch-label\">Activo<\/span>\n                            <\/label>\n                        <\/div>\n                        <div style=\"display:flex;align-items:flex-end;\">\n                            <button type=\"submit\" name=\"gofast_crear_fijo\" value=\"1\" class=\"gofast-small-btn\">\n                                \ud83d\udcbe Crear recargo fijo\n                            <\/button>\n                        <\/div>\n                    <\/div>\n                <\/div>\n\n                <!-- Listado de recargos fijos -->\n                <div class=\"gofast-box\">\n                    <h4 style=\"margin-top:0;\">\ud83d\udd27 Recargos Fijos Existentes<\/h4>\n                    <?php if (empty($recargos_fijos)): ?>\n                        <p style=\"margin:0;\">No hay recargos fijos creados.<\/p>\n                    <?php else: ?>\n                        <div class=\"gofast-table-wrap\" style=\"overflow-x: auto;\">\n                            <table class=\"gofast-recargos-table\">\n                                <thead>\n                                    <tr>\n                                        <th>Estado<\/th>\n                                        <th>Nombre<\/th>\n                                        <th>Valor fijo (COP)<\/th>\n                                    <\/tr>\n                                <\/thead>\n                                <tbody>\n                                <?php foreach ($recargos_fijos as $r): ?>\n                                    <tr class=\"<?= $r->activo ? 'gofast-row-active' : 'gofast-row-inactive'; ?>\">\n                                        <td>\n                                            <label class=\"gofast-switch\">\n                                                <input type=\"checkbox\"\n                                                       name=\"recargos[<?= esc_attr($r->id); ?>][activo]\"\n                                                       value=\"1\"\n                                                       <?= $r->activo ? 'checked' : ''; ?>>\n                                                <span class=\"gofast-switch-slider\"><\/span>\n                                                <span class=\"gofast-switch-label\">Activo<\/span>\n                                            <\/label>\n                                            <br>\n                                            <button type=\"button\"\n                                                    class=\"gofast-small-btn gofast-chip-danger gofast-delete-recargo\"\n                                                    data-recargo-id=\"<?= esc_attr($r->id); ?>\">\n                                                \ud83d\uddd1 Eliminar\n                                            <\/button>\n                                            <input type=\"hidden\"\n                                                   name=\"recargos[<?= esc_attr($r->id); ?>][tipo]\"\n                                                   value=\"fijo\">\n                                        <\/td>\n                                        <td>\n                                            <input type=\"text\"\n                                                   name=\"recargos[<?= esc_attr($r->id); ?>][nombre]\"\n                                                   value=\"<?= esc_attr($r->nombre); ?>\">\n                                        <\/td>\n                                        <td>\n                                            <input type=\"number\"\n                                                   name=\"recargos[<?= esc_attr($r->id); ?>][valor_fijo]\"\n                                                   value=\"<?= esc_attr($r->valor_fijo); ?>\"\n                                                   min=\"0\">\n                                        <\/td>\n                                    <\/tr>\n                                <?php endforeach; ?>\n                                <\/tbody>\n                            <\/table>\n                        <\/div>\n                    <?php endif; ?>\n                <\/div>\n            <\/div>\n\n            <!-- TAB: RECARGOS POR VALOR -->\n            <div id=\"tab-recargos-por-valor\" class=\"gofast-config-tab-content\" style=\"display: <?= $tab_activo === 'por_valor' ? 'block' : 'none' ?>;\">\n                <h3 style=\"margin-top:0;\">\ud83d\udcca Recargos por Valor<\/h3>\n                <p style=\"font-size:13px;color:#666;margin:8px 0 16px;\">\n                    Estos recargos se calculan seg\u00fan el valor de la cotizaci\u00f3n usando rangos de montos.\n                <\/p>\n\n                <!-- Formulario crear recargo por valor -->\n                <div class=\"gofast-box\" style=\"background: #f8f9fa; margin-bottom: 20px;\">\n                    <h4 style=\"margin-top: 0;\">\u2795 Crear Nuevo Recargo por Valor<\/h4>\n                    <div class=\"gofast-recargo-nuevo\">\n                        <div>\n                            <label>Nombre del recargo<\/label>\n                            <input type=\"text\" name=\"nuevo_var_nombre\" placeholder=\"Ej: Recargo por lluvia\" \/>\n                        <\/div>\n\n                        <div style=\"display:flex;align-items:flex-end;\">\n                            <label class=\"gofast-switch\">\n                                <input type=\"checkbox\" name=\"nuevo_var_activo\" value=\"1\" checked>\n                                <span class=\"gofast-switch-slider\"><\/span>\n                                <span class=\"gofast-switch-label\">Activo<\/span>\n                            <\/label>\n                        <\/div>\n\n                        <div style=\"flex:1;min-width:100%;\">\n                            <label style=\"display:block;margin-bottom:8px;font-weight:600;\">Rangos de valores:<\/label>\n                            <div class=\"gofast-table-wrap\" style=\"overflow-x: auto;\">\n                                <table class=\"gofast-rangos-table\">\n                                    <thead>\n                                        <tr>\n                                            <th>Monto m\u00ednimo<\/th>\n                                            <th>Monto m\u00e1ximo<\/th>\n                                            <th>Recargo (COP)<\/th>\n                                        <\/tr>\n                                    <\/thead>\n                                    <tbody id=\"gofast-nuevo-var-rangos\">\n                                        <tr>\n                                            <td><input type=\"number\" name=\"nuevo_var_rango_min[]\"   placeholder=\"0\" min=\"0\"><\/td>\n                                            <td><input type=\"number\" name=\"nuevo_var_rango_max[]\"   placeholder=\"0 = sin l\u00edmite\" min=\"0\"><\/td>\n                                            <td><input type=\"number\" name=\"nuevo_var_rango_valor[]\" placeholder=\"Ej: 2000\" min=\"0\"><\/td>\n                                        <\/tr>\n                                    <\/tbody>\n                                <\/table>\n                            <\/div>\n                            <button type=\"button\"\n                                    class=\"gofast-small-btn\"\n                                    id=\"btn-add-nuevo-var-rango\">\n                                \u2795 Agregar rango\n                            <\/button>\n                        <\/div>\n\n                        <div style=\"display:flex;align-items:flex-end;\">\n                            <button type=\"submit\" name=\"gofast_crear_variable\" value=\"1\" class=\"gofast-small-btn\">\n                                \ud83d\udcbe Crear recargo por valor\n                            <\/button>\n                        <\/div>\n                    <\/div>\n                <\/div>\n\n                <!-- Listado de recargos por valor -->\n                <div class=\"gofast-box\">\n                    <h4 style=\"margin-top:0;\">\ud83d\udd27 Recargos por Valor Existentes<\/h4>\n                    <?php if (empty($recargos_var)): ?>\n                        <p style=\"margin:0;\">No hay recargos por valor creados.<\/p>\n                    <?php else: ?>\n                        <?php foreach ($recargos_var as $r): ?>\n                            <div class=\"gofast-recargo-bloque <?= $r->activo ? 'gofast-row-active' : 'gofast-row-inactive'; ?>\" style=\"margin-bottom:20px;\">\n\n                                <div class=\"gofast-recargo-header\">\n                                    <div>\n                                        <label class=\"gofast-switch\">\n                                            <input type=\"checkbox\"\n                                                   name=\"recargos[<?= esc_attr($r->id); ?>][activo]\"\n                                                   value=\"1\"\n                                                   <?= $r->activo ? 'checked' : ''; ?>>\n                                            <span class=\"gofast-switch-slider\"><\/span>\n                                            <span class=\"gofast-switch-label\">Activo<\/span>\n                                        <\/label>\n\n                                        <span style=\"margin-left:10px;font-weight:600;\">\n                                            <?= esc_html($r->nombre); ?>\n                                        <\/span>\n                                    <\/div>\n\n                                    <div style=\"display:flex;align-items:center;gap:8px;\">\n                                        <span style=\"font-size:11px;background:#000;color:#fff;padding:3px 8px;border-radius:999px;\">\n                                            Tipo: por valor\n                                        <\/span>\n\n                                        <button type=\"button\"\n                                                class=\"gofast-small-btn gofast-chip-danger gofast-delete-recargo\"\n                                                data-recargo-id=\"<?= esc_attr($r->id); ?>\">\n                                            \ud83d\uddd1 Eliminar\n                                        <\/button>\n                                    <\/div>\n\n                                    <input type=\"hidden\"\n                                           name=\"recargos[<?= esc_attr($r->id); ?>][tipo]\"\n                                           value=\"por_valor\">\n                                    <input type=\"hidden\"\n                                           name=\"recargos[<?= esc_attr($r->id); ?>][nombre]\"\n                                           value=\"<?= esc_attr($r->nombre); ?>\">\n                                <\/div>\n\n                                <div class=\"gofast-table-wrap\" style=\"overflow-x: auto;\">\n                                    <table class=\"gofast-rangos-table\">\n                                        <thead>\n                                            <tr>\n                                                <th>Monto m\u00ednimo<\/th>\n                                                <th>Monto m\u00e1ximo<\/th>\n                                                <th>Recargo (COP)<\/th>\n                                                <th style=\"width:60px;\">Acciones<\/th>\n                                            <\/tr>\n                                        <\/thead>\n                                        <tbody>\n                                            <?php foreach ($rangos_por_recargo[$r->id] ?? [] as $rg): ?>\n                                                <tr>\n                                                    <td>\n                                                        <input type=\"number\"\n                                                               name=\"rangos[<?= esc_attr($r->id); ?>][<?= esc_attr($rg->id); ?>][min]\"\n                                                               value=\"<?= esc_attr($rg->monto_min); ?>\"\n                                                               min=\"0\">\n                                                    <\/td>\n                                                    <td>\n                                                        <input type=\"number\"\n                                                               name=\"rangos[<?= esc_attr($r->id); ?>][<?= esc_attr($rg->id); ?>][max]\"\n                                                               value=\"<?= esc_attr($rg->monto_max); ?>\"\n                                                               min=\"0\">\n                                                    <\/td>\n                                                    <td>\n                                                        <input type=\"number\"\n                                                               name=\"rangos[<?= esc_attr($r->id); ?>][<?= esc_attr($rg->id); ?>][valor]\"\n                                                               value=\"<?= esc_attr($rg->recargo); ?>\"\n                                                               min=\"0\">\n                                                    <\/td>\n                                                    <td style=\"text-align:center;\">\n                                                        <button type=\"button\"\n                                                                class=\"gofast-icon-btn gofast-chip-danger gofast-delete-rango\"\n                                                                data-rango-id=\"<?= esc_attr($rg->id); ?>\"\n                                                                title=\"Eliminar rango\">\n                                                            \ud83d\uddd1\n                                                        <\/button>\n                                                    <\/td>\n                                                <\/tr>\n                                            <?php endforeach; ?>\n\n                                            <!-- Fila para nuevos rangos -->\n                                            <tr class=\"gofast-rango-nuevo\" data-recargo-id=\"<?= esc_attr($r->id); ?>\">\n                                                <td>\n                                                    <input type=\"number\"\n                                                           name=\"nuevos_rangos[<?= esc_attr($r->id); ?>][min][]\"\n                                                           placeholder=\"0\" min=\"0\">\n                                                <\/td>\n                                                <td>\n                                                    <input type=\"number\"\n                                                           name=\"nuevos_rangos[<?= esc_attr($r->id); ?>][max][]\"\n                                                           placeholder=\"0 = sin l\u00edmite\" min=\"0\">\n                                                <\/td>\n                                                <td>\n                                                    <input type=\"number\"\n                                                           name=\"nuevos_rangos[<?= esc_attr($r->id); ?>][valor][]\"\n                                                           placeholder=\"Ej: 2000\" min=\"0\">\n                                                <\/td>\n                                                <td><\/td>\n                                            <\/tr>\n                                        <\/tbody>\n                                    <\/table>\n                                <\/div>\n\n                                <button type=\"button\"\n                                        class=\"gofast-small-btn\"\n                                        onclick=\"gofastAgregarRangoExistente(<?= esc_attr($r->id); ?>)\">\n                                    \u2795 Agregar rango\n                                <\/button>\n                            <\/div>\n                        <?php endforeach; ?>\n                    <?php endif; ?>\n                <\/div>\n            <\/div>\n\n            <!-- TAB: RECARGOS SELECCIONABLES -->\n            <div id=\"tab-recargos-seleccionables\" class=\"gofast-config-tab-content\" style=\"display: <?= $tab_activo === 'seleccionables' ? 'block' : 'none' ?>;\">\n                <h3 style=\"margin-top:0;\">\u2705 Recargos Fijos Seleccionables<\/h3>\n                <p style=\"font-size:13px;color:#666;margin:8px 0 16px;\">\n                    Estos recargos son fijos y se pueden seleccionar manualmente durante la cotizaci\u00f3n. \n                    \u00datiles para recargos por volumen, peso, o cualquier otro concepto.\n                <\/p>\n\n                <!-- Formulario crear recargo seleccionable -->\n                <div class=\"gofast-box\" style=\"background: #f8f9fa; margin-bottom: 20px;\">\n                    <h4 style=\"margin-top: 0;\">\u2795 Crear Nuevo Recargo Seleccionable<\/h4>\n                    <div class=\"gofast-recargo-nuevo\">\n                        <div>\n                            <label>Nombre del recargo<\/label>\n                            <input type=\"text\" name=\"nuevo_vp_nombre\" placeholder=\"Ej: Recargo por paquete grande\" \/>\n                        <\/div>\n                        <div>\n                            <label>Valor fijo (COP)<\/label>\n                            <input type=\"number\" name=\"nuevo_vp_valor\" placeholder=\"Ej: 5000\" min=\"0\" \/>\n                        <\/div>\n                        <div style=\"display:flex;align-items:flex-end;\">\n                            <label class=\"gofast-switch\">\n                                <input type=\"checkbox\" name=\"nuevo_vp_activo\" value=\"1\" checked>\n                                <span class=\"gofast-switch-slider\"><\/span>\n                                <span class=\"gofast-switch-label\">Activo<\/span>\n                            <\/label>\n                        <\/div>\n                        <div style=\"display:flex;align-items:flex-end;\">\n                            <button type=\"submit\" name=\"gofast_crear_volumen_peso\" value=\"1\" class=\"gofast-small-btn\">\n                                \ud83d\udcbe Crear recargo seleccionable\n                            <\/button>\n                        <\/div>\n                    <\/div>\n                <\/div>\n\n                <!-- Listado de recargos seleccionables -->\n                <div class=\"gofast-box\">\n                    <h4 style=\"margin-top:0;\">\ud83d\udd27 Recargos Seleccionables Existentes<\/h4>\n                    <?php if (empty($recargos_vp)): ?>\n                        <p style=\"margin:0;\">No hay recargos fijos seleccionables creados.<\/p>\n                    <?php else: ?>\n                        <div class=\"gofast-table-wrap\" style=\"overflow-x: auto;\">\n                            <table class=\"gofast-recargos-table\">\n                                <thead>\n                                    <tr>\n                                        <th>Estado<\/th>\n                                        <th>Nombre<\/th>\n                                        <th>Valor fijo (COP)<\/th>\n                                    <\/tr>\n                                <\/thead>\n                                <tbody>\n                                <?php foreach ($recargos_vp as $r): ?>\n                                    <tr class=\"<?= $r->activo ? 'gofast-row-active' : 'gofast-row-inactive'; ?>\">\n                                        <td>\n                                            <label class=\"gofast-switch\">\n                                                <input type=\"checkbox\"\n                                                       name=\"recargos[<?= esc_attr($r->id); ?>][activo]\"\n                                                       value=\"1\"\n                                                       <?= $r->activo ? 'checked' : ''; ?>>\n                                                <span class=\"gofast-switch-slider\"><\/span>\n                                                <span class=\"gofast-switch-label\">Activo<\/span>\n                                            <\/label>\n                                            <br>\n                                            <button type=\"button\"\n                                                    class=\"gofast-small-btn gofast-chip-danger gofast-delete-recargo\"\n                                                    data-recargo-id=\"<?= esc_attr($r->id); ?>\">\n                                                \ud83d\uddd1 Eliminar\n                                            <\/button>\n                                            <input type=\"hidden\"\n                                                   name=\"recargos[<?= esc_attr($r->id); ?>][tipo]\"\n                                                   value=\"por_volumen_peso\">\n                                        <\/td>\n                                        <td>\n                                            <input type=\"text\"\n                                                   name=\"recargos[<?= esc_attr($r->id); ?>][nombre]\"\n                                                   value=\"<?= esc_attr($r->nombre); ?>\">\n                                        <\/td>\n                                        <td>\n                                            <input type=\"number\"\n                                                   name=\"recargos[<?= esc_attr($r->id); ?>][valor_fijo]\"\n                                                   value=\"<?= esc_attr($r->valor_fijo); ?>\"\n                                                   min=\"0\">\n                                        <\/td>\n                                    <\/tr>\n                                <?php endforeach; ?>\n                                <\/tbody>\n                            <\/table>\n                        <\/div>\n                    <?php endif; ?>\n                <\/div>\n            <\/div>\n\n            <div style=\"margin-top:18px;text-align:right;\">\n                <button type=\"submit\"\n                        name=\"gofast_guardar_recargos\"\n                        value=\"1\"\n                        class=\"gofast-btn-request\"\n                        style=\"max-width:260px;margin-left:auto;\">\n                    \ud83d\udcbe Guardar cambios\n                <\/button>\n            <\/div>\n        <\/form>\n    <\/div>\n<\/div>\n\n<script>\n\/\/ Proteger contra errores de toggleOtro si se ejecuta desde otro archivo\n(function() {\n    const tipoSelectExists = document.getElementById(\"tipo_negocio\");\n    const wrapperOtroExists = document.getElementById(\"tipo_otro_wrapper\");\n    \n    \/\/ Si los elementos no existen, crear una funci\u00f3n segura desde el inicio\n    if (!tipoSelectExists || !wrapperOtroExists) {\n        if (typeof window.toggleOtro === 'undefined') {\n            window.toggleOtro = function() {\n                \/\/ Funci\u00f3n vac\u00eda segura - no hacer nada\n                return;\n            };\n        } else if (typeof window.toggleOtro === 'function') {\n            \/\/ Si existe y los elementos no est\u00e1n presentes, proteger la funci\u00f3n\n            const originalToggleOtro = window.toggleOtro;\n            window.toggleOtro = function() {\n                try {\n                    const tipoSelect = document.getElementById(\"tipo_negocio\");\n                    const wrapperOtro = document.getElementById(\"tipo_otro_wrapper\");\n                    if (tipoSelect && wrapperOtro && tipoSelect.parentNode && wrapperOtro.parentNode) {\n                        return originalToggleOtro();\n                    }\n                } catch(e) {\n                    \/\/ Silenciar error completamente\n                    return;\n                }\n            };\n        }\n    }\n    \n    \/\/ Tambi\u00e9n prevenir que setTimeout ejecute toggleOtro si no est\u00e1n los elementos\n    const originalSetTimeout = window.setTimeout;\n    window.setTimeout = function(func, delay) {\n        if (typeof func === 'function') {\n            const funcStr = func.toString();\n            if (funcStr.includes('toggleOtro')) {\n                const tipoSelect = document.getElementById(\"tipo_negocio\");\n                const wrapperOtro = document.getElementById(\"tipo_otro_wrapper\");\n                if (!tipoSelect || !wrapperOtro) {\n                    return null; \/\/ No ejecutar si no existen los elementos\n                }\n            }\n        }\n        return originalSetTimeout.apply(this, arguments);\n    };\n})();\n\n\/\/ Funci\u00f3n global para cambiar tabs de recargos\nwindow.mostrarTabRecargos = function(tab) {\n    document.querySelectorAll('.gofast-config-tab-content').forEach(function(content) {\n        content.style.display = 'none';\n    });\n    \n    document.querySelectorAll('.gofast-config-tab').forEach(function(btn) {\n        btn.classList.remove('gofast-config-tab-active');\n    });\n    \n    const tabId = 'tab-recargos-' + (tab === 'fijos' ? 'fijos' : tab === 'por_valor' ? 'por-valor' : 'seleccionables');\n    const tabElement = document.getElementById(tabId);\n    if (tabElement) {\n        tabElement.style.display = 'block';\n    }\n    \n    document.querySelectorAll('.gofast-config-tab').forEach(function(btn) {\n        const btnText = btn.textContent.trim();\n        if ((tab === 'fijos' && btnText.includes('Fijos')) ||\n            (tab === 'por_valor' && btnText.includes('Valor')) ||\n            (tab === 'seleccionables' && btnText.includes('Seleccionables'))) {\n            btn.classList.add('gofast-config-tab-active');\n        }\n    });\n    \n    const url = new URL(window.location);\n    url.searchParams.set('tab', tab);\n    window.history.pushState({}, '', url);\n};\n\ndocument.addEventListener('DOMContentLoaded', function(){\n    const urlParams = new URLSearchParams(window.location.search);\n    const tabParam = urlParams.get('tab');\n    if (tabParam && (tabParam === 'fijos' || tabParam === 'por_valor' || tabParam === 'seleccionables')) {\n        window.mostrarTabRecargos(tabParam);\n    }\n\n    \/\/ Duplicar fila de rangos para \"nuevo recargo por valor\"\n    const nuevoVarBody = document.getElementById('gofast-nuevo-var-rangos');\n    const btnAddNuevoVar = document.getElementById('btn-add-nuevo-var-rango');\n    if (btnAddNuevoVar && nuevoVarBody) {\n        btnAddNuevoVar.addEventListener('click', function(){\n            const first = nuevoVarBody.querySelector('tr');\n            if (!first) return;\n            const clone = first.cloneNode(true);\n            clone.querySelectorAll('input').forEach(i => i.value = '');\n            nuevoVarBody.appendChild(clone);\n        });\n    }\n\n    \/\/ Funci\u00f3n global para agregar rango en recargos existentes\n    window.gofastAgregarRangoExistente = function(recargoId){\n        const filas = document.querySelectorAll(\n            '.gofast-rango-nuevo[data-recargo-id=\"'+recargoId+'\"]'\n        );\n        if (!filas.length) return;\n        const ref = filas[filas.length - 1];\n        const clone = ref.cloneNode(true);\n        clone.querySelectorAll('input').forEach(i => i.value = '');\n        ref.parentNode.appendChild(clone);\n    };\n\n    \/\/ Eliminar recargo completo\n    document.querySelectorAll('.gofast-delete-recargo').forEach(function(btn){\n        btn.addEventListener('click', function(){\n            const id = btn.getAttribute('data-recargo-id');\n            if (!id) return;\n\n            if (!confirm('\u00bfSeguro que quieres eliminar este recargo y todos sus rangos?')) {\n                return;\n            }\n\n            const form = btn.closest('form');\n            if (!form) return;\n\n            let input = form.querySelector('input[name=\"eliminar_recargo['+id+']\"]');\n            if (!input) {\n                input = document.createElement('input');\n                input.type = 'hidden';\n                input.name = 'eliminar_recargo['+id+']';\n                input.value = '1';\n                form.appendChild(input);\n            }\n\n            let flag = form.querySelector('input[name=\"gofast_guardar_recargos\"]');\n            if (!flag) {\n                flag = document.createElement('input');\n                flag.type = 'hidden';\n                flag.name = 'gofast_guardar_recargos';\n                flag.value = '1';\n                form.appendChild(flag);\n            }\n\n            form.submit();\n        });\n    });\n\n    \/\/ Eliminar rango individual\n    document.querySelectorAll('.gofast-delete-rango').forEach(function(btn){\n        btn.addEventListener('click', function(){\n            const id = btn.getAttribute('data-rango-id');\n            if (!id) return;\n\n            if (!confirm('\u00bfEliminar este rango?')) {\n                return;\n            }\n\n            const form = btn.closest('form');\n            if (!form) return;\n\n            let input = form.querySelector('input[name=\"eliminar_rango['+id+']\"]');\n            if (!input) {\n                input = document.createElement('input');\n                input.type = 'hidden';\n                input.name = 'eliminar_rango['+id+']';\n                input.value = '1';\n                form.appendChild(input);\n            }\n\n            let flag = form.querySelector('input[name=\"gofast_guardar_recargos\"]');\n            if (!flag) {\n                flag = document.createElement('input');\n                flag.type = 'hidden';\n                flag.name = 'gofast_guardar_recargos';\n                flag.value = '1';\n                form.appendChild(flag);\n            }\n\n            form.submit();\n        });\n    });\n});\n<\/script>\n\n<?php\n    return ob_get_clean();\n}\nadd_shortcode('gofast_recargos_admin', 'gofast_recargos_admin_shortcode');\n","active":true,"modified":"2025-12-11 01:39:50","revision":"1"}]}