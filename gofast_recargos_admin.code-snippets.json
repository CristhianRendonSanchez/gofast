{"generator":"Code Snippets v3.9.2","date_created":"2025-11-21 22:43","snippets":[{"id":22,"name":"gofast_recargos_admin","code":"\/***************************************************\n * GOFAST \u2013 ADMIN RECARGOS (shortcode)\n * [gofast_recargos_admin]\n ***************************************************\/\nfunction gofast_recargos_admin_shortcode() {\n    if (session_status() === PHP_SESSION_NONE) {\n        session_start();\n    }\n\n    global $wpdb;\n\n    $tabla_recargos = 'recargos';\n    $tabla_rangos   = 'recargos_rangos';\n\n    $mensaje = '';\n\n    \/* ==========================================================\n       0. Validar usuario admin (usuarios_gofast.rol = 'admin')\n    ========================================================== *\/\n    $usuario = null;\n    if (!empty($_SESSION['gofast_user_id'])) {\n        $uid = (int) $_SESSION['gofast_user_id'];\n        $usuario = $wpdb->get_row(\n            \"SELECT id, nombre, rol, activo \n             FROM usuarios_gofast \n             WHERE id = $uid AND activo = 1\"\n        );\n    }\n\n    if (!$usuario || strtolower($usuario->rol) !== 'admin') {\n        return \"<div class='gofast-box'>\n                    \u26a0\ufe0f Solo los administradores pueden gestionar recargos.\n                <\/div>\";\n    }\n\n    \/* ==========================================================\n       1. Procesar POST (crear, editar, eliminar)\n    ========================================================== *\/\n    if ($_SERVER['REQUEST_METHOD'] === 'POST') {\n\n        if (\n            empty($_POST['gofast_recargos_nonce']) ||\n            !wp_verify_nonce($_POST['gofast_recargos_nonce'], 'gofast_recargos_admin')\n        ) {\n            return \"<div class='gofast-box'>\ud83d\udd12 Error de seguridad al guardar cambios.<\/div>\";\n        }\n\n        \/* ----------------------------------------------\n           A) Crear nuevo recargo FIJO\n        ---------------------------------------------- *\/\n        if (!empty($_POST['gofast_crear_fijo'])) {\n\n            $nombre     = sanitize_text_field($_POST['nuevo_fijo_nombre'] ?? '');\n            $valor_fijo = (int) ($_POST['nuevo_fijo_valor'] ?? 0);\n            $activo     = !empty($_POST['nuevo_fijo_activo']) ? 1 : 0;\n\n            if ($nombre !== '' && $valor_fijo > 0) {\n                $ok = $wpdb->insert($tabla_recargos, [\n                    'nombre'     => $nombre,\n                    'tipo'       => 'fijo',\n                    'valor_fijo' => $valor_fijo,\n                    'activo'     => $activo,\n                ]);\n\n                if ($ok !== false) {\n                    $mensaje = \"\u2705 Recargo fijo creado correctamente.\";\n                } else {\n                    $mensaje = \"\u274c Error al crear recargo fijo: \" . esc_html($wpdb->last_error);\n                }\n            } else {\n                $mensaje = \"\u26a0\ufe0f Debes indicar nombre y valor fijo mayor a 0.\";\n            }\n        }\n\n        \/* ----------------------------------------------\n           B) Crear nuevo recargo POR VALOR + rangos\n        ---------------------------------------------- *\/\n        if (!empty($_POST['gofast_crear_variable'])) {\n\n            $nombre = sanitize_text_field($_POST['nuevo_var_nombre'] ?? '');\n            $activo = !empty($_POST['nuevo_var_activo']) ? 1 : 0;\n\n            $mins   = $_POST['nuevo_var_rango_min']   ?? [];\n            $maxs   = $_POST['nuevo_var_rango_max']   ?? [];\n            $valors = $_POST['nuevo_var_rango_valor'] ?? [];\n\n            if ($nombre === '') {\n                $mensaje = \"\u26a0\ufe0f Debes indicar un nombre para el recargo variable.\";\n            } else {\n                $ok = $wpdb->insert($tabla_recargos, [\n                    'nombre'     => $nombre,\n                    'tipo'       => 'por_valor',\n                    'valor_fijo' => 0,\n                    'activo'     => $activo,\n                ]);\n\n                if ($ok === false) {\n                    $mensaje = \"\u274c Error al crear recargo variable: \" . esc_html($wpdb->last_error);\n                } else {\n                    $recargo_id = (int) $wpdb->insert_id;\n\n                    \/\/ Insertar rangos iniciales (si vienen)\n                    if (!empty($mins) && is_array($mins)) {\n                        foreach ($mins as $idx => $min) {\n                            $min   = (int) ($mins[$idx]   ?? 0);\n                            $max   = (int) ($maxs[$idx]   ?? 0);\n                            $rec   = (int) ($valors[$idx] ?? 0);\n\n                            if ($rec <= 0) {\n                                continue;\n                            }\n\n                            $wpdb->insert($tabla_rangos, [\n                                'recargo_id' => $recargo_id,\n                                'monto_min'  => $min,\n                                'monto_max'  => $max,\n                                'recargo'    => $rec,\n                                'activo'     => 1,\n                            ]);\n                        }\n                    }\n\n                    $mensaje = \"\u2705 Recargo por valor creado correctamente.\";\n                }\n            }\n        }\n\n        \/* ----------------------------------------------\n           C) Editar \/ eliminar recargos + rangos\n        ---------------------------------------------- *\/\n        if (!empty($_POST['gofast_guardar_recargos'])) {\n\n            \/\/ 1) Eliminar RANGOS seleccionados\n            if (!empty($_POST['eliminar_rango']) && is_array($_POST['eliminar_rango'])) {\n                foreach ($_POST['eliminar_rango'] as $rid => $flag) {\n                    if ($flag != '1') continue;\n                    $rid = (int) $rid;\n                    if ($rid > 0) {\n                        $wpdb->delete($tabla_rangos, ['id' => $rid]);\n                    }\n                }\n            }\n\n            \/\/ 2) Eliminar RECARGOS seleccionados (y sus rangos)\n            if (!empty($_POST['eliminar_recargo']) && is_array($_POST['eliminar_recargo'])) {\n                foreach ($_POST['eliminar_recargo'] as $rid => $flag) {\n                    if ($flag != '1') continue;\n                    $rid = (int) $rid;\n                    if ($rid > 0) {\n                        $wpdb->delete($tabla_rangos, ['recargo_id' => $rid]);\n                        $wpdb->delete($tabla_recargos, ['id' => $rid]);\n                    }\n                }\n            }\n\n            \/\/ 3) Actualizar recargos existentes\n            if (!empty($_POST['recargos']) && is_array($_POST['recargos'])) {\n                foreach ($_POST['recargos'] as $rid => $data) {\n                    $rid = (int) $rid;\n                    if ($rid <= 0) continue;\n\n                    $activo     = !empty($data['activo']) ? 1 : 0;\n                    $nombre     = sanitize_text_field($data['nombre'] ?? '');\n                    $tipo       = $data['tipo'] ?? 'fijo';\n                    $valor_fijo = (int) ($data['valor_fijo'] ?? 0);\n\n                    $update_data = [\n                        'activo' => $activo,\n                        'nombre' => $nombre,\n                    ];\n\n                    if ($tipo === 'fijo') {\n                        $update_data['valor_fijo'] = $valor_fijo;\n                    }\n\n                    $wpdb->update(\n                        $tabla_recargos,\n                        $update_data,\n                        ['id' => $rid]\n                    );\n                }\n            }\n\n            \/\/ 4) Actualizar rangos existentes\n            if (!empty($_POST['rangos']) && is_array($_POST['rangos'])) {\n                foreach ($_POST['rangos'] as $recargo_id => $rangos) {\n                    foreach ($rangos as $rango_id => $datos) {\n                        $rango_id = (int) $rango_id;\n                        if ($rango_id <= 0) continue;\n\n                        $min = (int) ($datos['min']   ?? 0);\n                        $max = (int) ($datos['max']   ?? 0);\n                        $rec = (int) ($datos['valor'] ?? 0);\n\n                        $wpdb->update(\n                            $tabla_rangos,\n                            [\n                                'monto_min' => $min,\n                                'monto_max' => $max,\n                                'recargo'   => $rec,\n                            ],\n                            ['id' => $rango_id]\n                        );\n                    }\n                }\n            }\n\n            \/\/ 5) Nuevos rangos para recargos existentes\n            if (!empty($_POST['nuevos_rangos']) && is_array($_POST['nuevos_rangos'])) {\n                foreach ($_POST['nuevos_rangos'] as $recargo_id => $datos) {\n                    $recargo_id = (int) $recargo_id;\n                    if ($recargo_id <= 0) continue;\n\n                    $mins   = $datos['min']   ?? [];\n                    $maxs   = $datos['max']   ?? [];\n                    $valors = $datos['valor'] ?? [];\n\n                    if (!is_array($mins)) continue;\n\n                    foreach ($mins as $idx => $min) {\n                        $min = (int) ($mins[$idx]   ?? 0);\n                        $max = (int) ($maxs[$idx]   ?? 0);\n                        $rec = (int) ($valors[$idx] ?? 0);\n\n                        if ($rec <= 0) continue;\n\n                        $wpdb->insert($tabla_rangos, [\n                            'recargo_id' => $recargo_id,\n                            'monto_min'  => $min,\n                            'monto_max'  => $max,\n                            'recargo'    => $rec,\n                            'activo'     => 1,\n                        ]);\n                    }\n                }\n            }\n\n            if ($mensaje === '') {\n                $mensaje = \"\u2705 Cambios guardados correctamente.\";\n            }\n        }\n    }\n\n    \/* ==========================================================\n       2. Cargar recargos + rangos actuales\n    ========================================================== *\/\n    $recargos = $wpdb->get_results(\"\n        SELECT * FROM {$tabla_recargos}\n        ORDER BY tipo ASC, nombre ASC\n    \");\n\n    $recargos_fijos    = [];\n    $recargos_var      = [];\n    $rangos_por_recargo = [];\n\n    if ($recargos) {\n        foreach ($recargos as $r) {\n            if ($r->tipo === 'por_valor') {\n                $recargos_var[] = $r;\n            } else {\n                $recargos_fijos[] = $r;\n            }\n        }\n\n        if (!empty($recargos_var)) {\n            $ids = implode(',', array_map('intval', wp_list_pluck($recargos_var, 'id')));\n            $rangos = $wpdb->get_results(\"\n                SELECT * FROM {$tabla_rangos}\n                WHERE recargo_id IN ($ids)\n                ORDER BY recargo_id ASC, monto_min ASC\n            \");\n\n            foreach ($rangos as $rg) {\n                $rangos_por_recargo[$rg->recargo_id][] = $rg;\n            }\n        }\n    }\n\n    \/* ==========================================================\n       3. HTML\n    ========================================================== *\/\n    ob_start();\n    ?>\n\n<div class=\"gofast-home\">\n    <h1 style=\"margin-bottom:8px;\">\u2699\ufe0f Administraci\u00f3n de recargos<\/h1>\n    <p class=\"gofast-home-text\">\n        Define recargos fijos y por valor que se aplican autom\u00e1ticamente a las cotizaciones.\n    <\/p>\n\n    <?php if ($mensaje): ?>\n        <div class=\"gofast-box\" style=\"margin-bottom:15px;\">\n            <?= esc_html($mensaje); ?>\n        <\/div>\n    <?php endif; ?>\n\n    <form method=\"post\">\n        <?php wp_nonce_field('gofast_recargos_admin', 'gofast_recargos_nonce'); ?>\n\n        <!-- =====================================================\n             A) CREAR NUEVO RECARGO FIJO\n        ====================================================== -->\n        <div class=\"gofast-box\" style=\"margin-bottom:20px;\">\n            <h3 style=\"margin-top:0;\">\u2795 Nuevo recargo fijo<\/h3>\n\n            <div class=\"gofast-recargo-nuevo\">\n                <div>\n                    <label>Nombre del recargo<\/label>\n                    <input type=\"text\" name=\"nuevo_fijo_nombre\" placeholder=\"Ej: Recargo nocturno\" \/>\n                <\/div>\n                <div>\n                    <label>Valor fijo (COP)<\/label>\n                    <input type=\"number\" name=\"nuevo_fijo_valor\" placeholder=\"Ej: 2000\" min=\"0\" \/>\n                <\/div>\n                <div style=\"display:flex;align-items:flex-end;\">\n                    <label class=\"gofast-switch\">\n                        <input type=\"checkbox\" name=\"nuevo_fijo_activo\" value=\"1\" checked>\n                        <span class=\"gofast-switch-slider\"><\/span>\n                        <span class=\"gofast-switch-label\">Activo<\/span>\n                    <\/label>\n                <\/div>\n                <div style=\"display:flex;align-items:flex-end;\">\n                    <button type=\"submit\" name=\"gofast_crear_fijo\" class=\"gofast-small-btn\">\n                        \ud83d\udcbe Crear recargo fijo\n                    <\/button>\n                <\/div>\n            <\/div>\n        <\/div>\n\n        <!-- =====================================================\n             B) CREAR NUEVO RECARGO POR VALOR\n        ====================================================== -->\n        <div class=\"gofast-box\" style=\"margin-bottom:24px;\">\n            <h3 style=\"margin-top:0;\">\u2795 Nuevo recargo por valor<\/h3>\n\n            <div class=\"gofast-recargo-nuevo\">\n                <div>\n                    <label>Nombre del recargo<\/label>\n                    <input type=\"text\" name=\"nuevo_var_nombre\" placeholder=\"Ej: Recargo por lluvia\" \/>\n                <\/div>\n\n                <div style=\"display:flex;align-items:flex-end;\">\n                    <label class=\"gofast-switch\">\n                        <input type=\"checkbox\" name=\"nuevo_var_activo\" value=\"1\" checked>\n                        <span class=\"gofast-switch-slider\"><\/span>\n                        <span class=\"gofast-switch-label\">Activo<\/span>\n                    <\/label>\n                <\/div>\n\n                <div style=\"flex:1;min-width:100%;\">\n                    <table class=\"gofast-rangos-table\">\n                        <thead>\n                            <tr>\n                                <th>Monto m\u00ednimo<\/th>\n                                <th>Monto m\u00e1ximo<\/th>\n                                <th>Recargo (COP)<\/th>\n                            <\/tr>\n                        <\/thead>\n                        <tbody id=\"gofast-nuevo-var-rangos\">\n                            <tr>\n                                <td><input type=\"number\" name=\"nuevo_var_rango_min[]\"   placeholder=\"0\" min=\"0\"><\/td>\n                                <td><input type=\"number\" name=\"nuevo_var_rango_max[]\"   placeholder=\"0 = sin l\u00edmite\" min=\"0\"><\/td>\n                                <td><input type=\"number\" name=\"nuevo_var_rango_valor[]\" placeholder=\"Ej: 2000\" min=\"0\"><\/td>\n                            <\/tr>\n                        <\/tbody>\n                    <\/table>\n                    <button type=\"button\"\n                            class=\"gofast-small-btn\"\n                            id=\"btn-add-nuevo-var-rango\">\n                        \u2795 Agregar rango\n                    <\/button>\n                <\/div>\n\n                <div style=\"display:flex;align-items:flex-end;\">\n                    <button type=\"submit\" name=\"gofast_crear_variable\" class=\"gofast-small-btn\">\n                        \ud83d\udcbe Crear recargo por valor\n                    <\/button>\n                <\/div>\n            <\/div>\n        <\/div>\n\n        <!-- =====================================================\n             C) EDITAR RECARGOS EXISTENTES\n        ====================================================== -->\n\n        <!-- 1) Recargos FIJOS -->\n        <div class=\"gofast-box\" style=\"margin-bottom:24px;\">\n            <h3 style=\"margin-top:0;\">\ud83d\udd27 Recargos fijos<\/h3>\n\n            <?php if (empty($recargos_fijos)): ?>\n                <p style=\"margin:0;\">No hay recargos fijos creados.<\/p>\n            <?php else: ?>\n                <table class=\"gofast-recargos-table\">\n                    <thead>\n                        <tr>\n                            <th>Estado<\/th>\n                            <th>Nombre<\/th>\n                            <th>Valor fijo (COP)<\/th>\n                        <\/tr>\n                    <\/thead>\n                    <tbody>\n                    <?php foreach ($recargos_fijos as $r): ?>\n                        <tr class=\"<?= $r->activo ? 'gofast-row-active' : 'gofast-row-inactive'; ?>\">\n                            <td>\n                                <label class=\"gofast-switch\">\n                                    <input type=\"checkbox\"\n                                           name=\"recargos[<?= esc_attr($r->id); ?>][activo]\"\n                                           value=\"1\"\n                                           <?= $r->activo ? 'checked' : ''; ?>>\n                                    <span class=\"gofast-switch-slider\"><\/span>\n                                    <span class=\"gofast-switch-label\">Activo<\/span>\n                                <\/label>\n                                <br>\n                                <button type=\"button\"\n                                        class=\"gofast-small-btn gofast-chip-danger gofast-delete-recargo\"\n                                        data-recargo-id=\"<?= esc_attr($r->id); ?>\">\n                                    \ud83d\uddd1 Eliminar\n                                <\/button>\n                                <input type=\"hidden\"\n                                       name=\"recargos[<?= esc_attr($r->id); ?>][tipo]\"\n                                       value=\"fijo\">\n                            <\/td>\n                            <td>\n                                <input type=\"text\"\n                                       name=\"recargos[<?= esc_attr($r->id); ?>][nombre]\"\n                                       value=\"<?= esc_attr($r->nombre); ?>\">\n                            <\/td>\n                            <td>\n                                <input type=\"number\"\n                                       name=\"recargos[<?= esc_attr($r->id); ?>][valor_fijo]\"\n                                       value=\"<?= esc_attr($r->valor_fijo); ?>\"\n                                       min=\"0\">\n                            <\/td>\n                        <\/tr>\n                    <?php endforeach; ?>\n                    <\/tbody>\n                <\/table>\n            <?php endif; ?>\n        <\/div>\n\n        <!-- 2) Recargos POR VALOR -->\n        <div class=\"gofast-box\">\n            <h3 style=\"margin-top:0;\">\ud83d\udd27 Recargos por valor<\/h3>\n\n            <?php if (empty($recargos_var)): ?>\n                <p style=\"margin:0;\">No hay recargos por valor creados.<\/p>\n            <?php else: ?>\n                <?php foreach ($recargos_var as $r): ?>\n                    <div class=\"gofast-recargo-bloque <?= $r->activo ? 'gofast-row-active' : 'gofast-row-inactive'; ?>\">\n\n                        <div class=\"gofast-recargo-header\">\n                            <div>\n                                <label class=\"gofast-switch\">\n                                    <input type=\"checkbox\"\n                                           name=\"recargos[<?= esc_attr($r->id); ?>][activo]\"\n                                           value=\"1\"\n                                           <?= $r->activo ? 'checked' : ''; ?>>\n                                    <span class=\"gofast-switch-slider\"><\/span>\n                                    <span class=\"gofast-switch-label\">Activo<\/span>\n                                <\/label>\n\n                                <span style=\"margin-left:10px;font-weight:600;\">\n                                    <?= esc_html($r->nombre); ?>\n                                <\/span>\n                            <\/div>\n\n                            <div style=\"display:flex;align-items:center;gap:8px;\">\n                                <span style=\"font-size:11px;background:#000;color:#fff;padding:3px 8px;border-radius:999px;\">\n                                    Tipo: por valor\n                                <\/span>\n\n                                <button type=\"button\"\n                                        class=\"gofast-small-btn gofast-chip-danger gofast-delete-recargo\"\n                                        data-recargo-id=\"<?= esc_attr($r->id); ?>\">\n                                    \ud83d\uddd1 Eliminar\n                                <\/button>\n                            <\/div>\n\n                            <input type=\"hidden\"\n                                   name=\"recargos[<?= esc_attr($r->id); ?>][tipo]\"\n                                   value=\"por_valor\">\n                            <input type=\"hidden\"\n                                   name=\"recargos[<?= esc_attr($r->id); ?>][nombre]\"\n                                   value=\"<?= esc_attr($r->nombre); ?>\">\n                        <\/div>\n\n                        <table class=\"gofast-rangos-table\">\n                            <thead>\n                                <tr>\n                                    <th>Monto m\u00ednimo<\/th>\n                                    <th>Monto m\u00e1ximo<\/th>\n                                    <th>Recargo (COP)<\/th>\n                                    <th style=\"width:60px;\">Acciones<\/th>\n                                <\/tr>\n                            <\/thead>\n                            <tbody>\n                                <?php foreach ($rangos_por_recargo[$r->id] ?? [] as $rg): ?>\n                                    <tr>\n                                        <td>\n                                            <input type=\"number\"\n                                                   name=\"rangos[<?= esc_attr($r->id); ?>][<?= esc_attr($rg->id); ?>][min]\"\n                                                   value=\"<?= esc_attr($rg->monto_min); ?>\"\n                                                   min=\"0\">\n                                        <\/td>\n                                        <td>\n                                            <input type=\"number\"\n                                                   name=\"rangos[<?= esc_attr($r->id); ?>][<?= esc_attr($rg->id); ?>][max]\"\n                                                   value=\"<?= esc_attr($rg->monto_max); ?>\"\n                                                   min=\"0\">\n                                        <\/td>\n                                        <td>\n                                            <input type=\"number\"\n                                                   name=\"rangos[<?= esc_attr($r->id); ?>][<?= esc_attr($rg->id); ?>][valor]\"\n                                                   value=\"<?= esc_attr($rg->recargo); ?>\"\n                                                   min=\"0\">\n                                        <\/td>\n                                        <td style=\"text-align:center;\">\n                                            <button type=\"button\"\n                                                    class=\"gofast-icon-btn gofast-chip-danger gofast-delete-rango\"\n                                                    data-rango-id=\"<?= esc_attr($rg->id); ?>\"\n                                                    title=\"Eliminar rango\">\n                                                \ud83d\uddd1\n                                            <\/button>\n                                        <\/td>\n                                    <\/tr>\n                                <?php endforeach; ?>\n\n                                <!-- Fila para nuevos rangos -->\n                                <tr class=\"gofast-rango-nuevo\" data-recargo-id=\"<?= esc_attr($r->id); ?>\">\n                                    <td>\n                                        <input type=\"number\"\n                                               name=\"nuevos_rangos[<?= esc_attr($r->id); ?>][min][]\"\n                                               placeholder=\"0\" min=\"0\">\n                                    <\/td>\n                                    <td>\n                                        <input type=\"number\"\n                                               name=\"nuevos_rangos[<?= esc_attr($r->id); ?>][max][]\"\n                                               placeholder=\"0 = sin l\u00edmite\" min=\"0\">\n                                    <\/td>\n                                    <td>\n                                        <input type=\"number\"\n                                               name=\"nuevos_rangos[<?= esc_attr($r->id); ?>][valor][]\"\n                                               placeholder=\"Ej: 2000\" min=\"0\">\n                                    <\/td>\n                                    <td><\/td>\n                                <\/tr>\n                            <\/tbody>\n                        <\/table>\n\n                        <button type=\"button\"\n                                class=\"gofast-small-btn\"\n                                onclick=\"gofastAgregarRangoExistente(<?= esc_attr($r->id); ?>)\">\n                            \u2795 Agregar rango\n                        <\/button>\n                    <\/div>\n                <?php endforeach; ?>\n            <?php endif; ?>\n        <\/div>\n\n        <div style=\"margin-top:18px;text-align:right;\">\n            <button type=\"submit\"\n                    name=\"gofast_guardar_recargos\"\n                    value=\"1\"\n                    class=\"gofast-btn-request\"\n                    style=\"max-width:260px;margin-left:auto;\">\n                \ud83d\udcbe Guardar cambios\n            <\/button>\n        <\/div>\n    <\/form>\n<\/div>\n\n<script>\ndocument.addEventListener('DOMContentLoaded', function(){\n\n    \/\/ Duplicar fila de rangos para \"nuevo recargo por valor\"\n    const nuevoVarBody = document.getElementById('gofast-nuevo-var-rangos');\n    const btnAddNuevoVar = document.getElementById('btn-add-nuevo-var-rango');\n    if (btnAddNuevoVar && nuevoVarBody) {\n        btnAddNuevoVar.addEventListener('click', function(){\n            const first = nuevoVarBody.querySelector('tr');\n            if (!first) return;\n            const clone = first.cloneNode(true);\n            clone.querySelectorAll('input').forEach(i => i.value = '');\n            nuevoVarBody.appendChild(clone);\n        });\n    }\n\n    \/\/ Funci\u00f3n global para agregar rango en recargos existentes\n    window.gofastAgregarRangoExistente = function(recargoId){\n        const filas = document.querySelectorAll(\n            '.gofast-rango-nuevo[data-recargo-id=\"'+recargoId+'\"]'\n        );\n        if (!filas.length) return;\n        const ref = filas[filas.length - 1];\n        const clone = ref.cloneNode(true);\n        clone.querySelectorAll('input').forEach(i => i.value = '');\n        ref.parentNode.appendChild(clone);\n    };\n\n    \/\/ Eliminar recargo completo\n    document.querySelectorAll('.gofast-delete-recargo').forEach(function(btn){\n        btn.addEventListener('click', function(){\n            const id = btn.getAttribute('data-recargo-id');\n            if (!id) return;\n\n            if (!confirm('\u00bfSeguro que quieres eliminar este recargo y todos sus rangos?')) {\n                return;\n            }\n\n            const form = btn.closest('form');\n            if (!form) return;\n\n            let input = form.querySelector('input[name=\"eliminar_recargo['+id+']\"]');\n            if (!input) {\n                input = document.createElement('input');\n                input.type = 'hidden';\n                input.name = 'eliminar_recargo['+id+']';\n                input.value = '1';\n                form.appendChild(input);\n            }\n\n            let flag = form.querySelector('input[name=\"gofast_guardar_recargos\"]');\n            if (!flag) {\n                flag = document.createElement('input');\n                flag.type = 'hidden';\n                flag.name = 'gofast_guardar_recargos';\n                flag.value = '1';\n                form.appendChild(flag);\n            }\n\n            form.submit();\n        });\n    });\n\n    \/\/ Eliminar rango individual\n    document.querySelectorAll('.gofast-delete-rango').forEach(function(btn){\n        btn.addEventListener('click', function(){\n            const id = btn.getAttribute('data-rango-id');\n            if (!id) return;\n\n            if (!confirm('\u00bfEliminar este rango?')) {\n                return;\n            }\n\n            const form = btn.closest('form');\n            if (!form) return;\n\n            let input = form.querySelector('input[name=\"eliminar_rango['+id+']\"]');\n            if (!input) {\n                input = document.createElement('input');\n                input.type = 'hidden';\n                input.name = 'eliminar_rango['+id+']';\n                input.value = '1';\n                form.appendChild(input);\n            }\n\n            let flag = form.querySelector('input[name=\"gofast_guardar_recargos\"]');\n            if (!flag) {\n                flag = document.createElement('input');\n                flag.type = 'hidden';\n                flag.name = 'gofast_guardar_recargos';\n                flag.value = '1';\n                form.appendChild(flag);\n            }\n\n            form.submit();\n        });\n    });\n});\n<\/script>\n\n<?php\n    return ob_get_clean();\n}\nadd_shortcode('gofast_recargos_admin', 'gofast_recargos_admin_shortcode');\n","active":true,"modified":"2025-11-16 00:18:29","revision":"1"}]}